<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>SYSPRO Product Visual Builder</title>

        <!-- Bootstrap -->
        <link href="css/new/UX_CSS_bootstrap.css" rel="stylesheet" />
        <link href="css/new/UX_CSS_bootstrap-main.css" rel="stylesheet" />


				<link href="css/postcss.css" rel="stylesheet" />
        <link href="css/UX_CSS_sysprofusionstyle.css" rel="stylesheet" />

				<link rel="stylesheet" href="css/gridstack.min.css">
				<link rel="stylesheet" href="css/gridstack-extra.css">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs-themes@1.0.0/tomorrow-night-blue.min.css">
            <!-- <link rel=”stylesheet” href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css"> -->

        <script>
            window.MSPointerEvent = null;
            window.PointerEvent = null;
        </script>
        <script type="text/javascript">
            WebFontConfig = {
                google: {
                    families: [
                        "Source+Sans+Pro:400,200,300,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic:latin",
                    ],
                },
            };
            (function() {
                var wf = document.createElement("script");
                wf.src = "https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";
                wf.type = "text/javascript";
                wf.async = "true";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(wf, s);
            })();
        </script>
        <script src="js/new/UX_JS_jquery.min.js"></script>
        <!-- <script src="js/UX_JS_velocity.min.js"></script> -->
        <script src="js/new/UX_JS_kendo.all.min.js"></script>
        <style>
         :root {
         --gradient-shadow: linear-gradient(
            45deg,
            #7B1FA2,
            #b90d7e,
            #ffffff

         );
         }
         

         @keyframes animate {
            0% {
               background-position: 0 0;
            }
            50% {
               background-position: 300% 0;
            }
            100% {
               background-position: 0 0;
            }
         }
         @keyframes border-pulsate {
            0%   { border-color: #b9086f; }
            50%  { border-color: #7B1FA2; }
            100% { border-color: #b9086f; }
         }
         @keyframes pulse-purple {
            0% {
               transform: scale(1);
               box-shadow: 0 0 0 0 rgba(123, 31, 162, 0.7);
            }
            
            70% {
               transform: scale(1);
               box-shadow: 0 0 0 8px rgba(123, 31, 162, 0);
            }
            
            100% {
               transform: scale(1);
               box-shadow: 0 0 0 0 rgba(123, 31, 162, 0);
            }
         }
         #davinciButton {
            border: 3px solid rgba(255, 255, 255, 0.3);
            outline: none;
            background-color: #8e8e8e;
            &.alive {
               background-color: #7B1FA2;
               background-image: linear-gradient(to right top, #7b1fa2, #8f1699, #a00e90, #ae0987, #b90d7e);
            }            
            z-index: 99;
            &.pulse {
               /* animation: border-pulsate 3s infinite; */
               animation: pulse-purple 2.4s infinite;
            }
            & .k-fab-text {
               display: none;
            }
            /* &:before,
            &:after {
               content: "";
               position: absolute;
               top: -2px;
               left: -2px;
               background: var(--gradient-shadow);
               background-size: 400%;
               width: calc(100% + 4px);
               height: calc(100% + 4px);
               z-index: -1;
               animation: animate 20s linear infinite;
            }
            &:after  {
               filter: blur(20px);
            } */
         }
         .k-author {
            display: none;
         }
         .k-typing-indicator-bubble .k-author {
            display: block;
         }
         .k-chat {
            border-color: transparent;
            color: #212529;
            background-color: transparent;
            max-width: none;
            border-top: none;
            & .k-message-box {
               border-top: 1px solid #eee !important;
               padding: 15px 15px 15px;
               justify-content: flex-end;
               & input {
                  background: #eee;
                  border-radius: 20px;
                  height: 40px;
                  margin-right: 5px;
                  max-width: 750px;
               }
               & .k-button {
                  height: 40px;
                  padding: 0px;
                  width: 40px;
                  border-radius: 50%;
                  background-image: linear-gradient(to right top, #7b1fa2, #8f1699, #a00e90, #ae0987, #b90d7e) !important;
               }
            }
            & .k-avatar:not([alt="sysproUser"]) {
               background: #7B1FA2;
               border-radius: 50%;
               padding: 9px;
               background-image: linear-gradient(to right top, #7b1fa2, #8f1699, #a00e90, #ae0987, #b90d7e) !important;
            }
            & .k-card {
               border-color: var(--color_athens_gray_approx) !important;
               & .k-card-header {
                  background-color: var(--color_athens_gray_approx);
                  border-color: var(--color_athens_gray_approx);
               }
               & .k-card-actions {
                  & .k-button {
                     border-radius: 4px;
                     &.k-button-sm {
                        background: transparent !important;
                        color: var(--color_lochmara_approx) !important;
                        font-size: 11px;
                     }
                     &.sys-bg-very-light-gray {
                        background-color: #ecf0f1 !important;
                        color: #2c3e50 !important;
                     }
                  }
               }
            }
            & .k-card-list {
               margin: 2px 0 15px;
               width: 100%;
               & .chat-user-msg-actions {
                  visibility: hidden;
                  content: "";
                  width: 90px;
                  height: 0px;
                  align-self: end;
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  & .material-icons {
                     font-size: 20px;
                  }
               }
               &:hover .chat-user-msg-actions {
                  visibility: visible;
               }
            }
            & .k-message-group {
               margin-bottom: 15px;
            }
            & .k-quick-replies {
               align-self: flex-end;
            }
            & .k-typing-indicator-bubble {
               & .k-bubble {
                  background-color: transparent;
                  border: none;
                  white-space: normal;
                  & .k-typing-indicator span {
                     background-color: #7b1fa2;
                  }
               }
            }
         }
         #daVinciWindow.k-window-content {
            padding-block: 0;
            padding-inline: 0;
         }
         .k-window[aria-labelledby="daVinciWindow_wnd_title"] {
            position: fixed !important;
            border-radius: 8px;
            & .k-window-titlebar {
               background-color: #7B1FA2 !important;
               background-image: linear-gradient(to right top, #7b1fa2, #8f1699, #a00e90, #ae0987, #b90d7e);
               padding-left: 0.8rem;
               border-top-left-radius: 8px;
               border-top-right-radius: 8px;
               & .k-window-titlebar-action {
                  color: white !important;
               }
            }
         }
         .davinciicon-light {
            color: rgb(162, 0, 162);
            opacity: 0.33;
            transition: opacity 0.25s;
            &:hover {
               opacity: 0.6;
            }
         }
         .davinciicon-dark {
            color: #7B1FA2;
         }
         .daVinciPopover {
            border: none;
            padding: 0px;
            & .popover-header {
               margin-top: 0px;
               background-color: #7B1FA2;
               background-image: linear-gradient(to right top, #7b1fa2, #8f1699, #a00e90, #ae0987, #b90d7e);
               padding: 0.2rem 0.5rem;
               color: #fff;
            }
            & .popover-body {
               padding: 0.5rem;
            }
            & .popover-footer {
               display: flex;
               justify-content: space-around;
               border-bottom-left-radius: 6px;
               border-bottom-right-radius: 6px;
               padding: 0.3rem 0.5rem;
               & a {
                  display: flex;
                  align-items: center;
                  &:hover {
                     text-decoration: none;
                  }
               }
            }
         }
         .daVinciPopoverTrigger, .daVinciDataPopoverTrigger, .daVinciAutoPopoverTrigger {
            cursor: pointer;
         }
         .fileUploadDropZone {
            /* border: none; */
            & .k-upload-button-wrap {
               width: 100%;
            }
         }

         .showmodelcard, .conflevel {
            cursor: pointer;
         }

         .models-table.table > tbody > tr > td {
            vertical-align: middle;
         }
         .davincifield {
            background-color: #e4b3e2 !important;
         }
         span.clickable {
            color: blue;
            text-decoration: underline;
            font-weight:bold;
            cursor: pointer
         }
         .k-chat .k-message-group, .k-chat .k-message-group.k-alt {
            align-items: center;
         }
         .k-message-group[me] {
            /* background: red; */
            flex-direction: row !important;
            & .chat-user-msg-actions {
               visibility: hidden;
               content: "";
               width: 30px;
               height: 30px;
               
            }
            &:hover .chat-user-msg-actions {
               visibility: visible;
            }
         }

         .k-chat .k-message-group.k-alt {
            text-align: start;
         }

         :not(#context-menu-list) #faves-menu.k-menu-vertical > .k-menu-item > .k-menu-link {
            padding-top: 0.35rem;
            padding-bottom: 0.35rem;
            border-bottom: 1px solid #f0f0f0;
         }
         .k-wizard .k-input-solid.k-focus {
            border: 1px solid #0d6efd;
         }
         .k-popup {
            font-family: inherit !important;
         }
         .view-record {
            cursor: pointer;
         }
        </style>
    </head>

<body data-theme="" data-column-layout="" class="light-gradient-background body-view-mode">
  <nav id="fusion-toolbar" class="navbar navbar-default fixed-top navbar-controlbar fusion-top-toolbar toolbar-loaded">
    <div class="container-fluid">
        <ul class="nav navbar-nav navbar-left">
            <li class="nav-item">
                <a href="#" class="text-primary offcanvas-toggle fusion-main-page-buttons fusion-maininstance-buttons nav-link js-offcanvas-has-events" data-toggle="offcanvas" data-target="#fusion-sidebar-wrapper2" onclick="sysproInterop.bindProgramList($('#fusion-sidebar-wrapper2'));" style=""><i class="material-icons">menu</i></a>
            </li>
            <li>
                <a class="navbar-brand" href="#" onclick="sysproInterop.backToMenu();">
                    <img alt="Brand" src="img/UX_IMG_SYSPROLogo.png" style="height: 35px">
                </a>
            </li>
            <li class="nav-item back-to-menu">
                <a href="#" onclick="sysproInterop.backToMenu();" class="text-primary fusion-main-page-buttons fusion-maininstance-buttons nav-link" style=""><span class="hidden-xs">Home</span><i class="material-icons visible-xs">home</i></a>
            </li>
            <li class="nav-item breadcrumb-separator fusion-main-page-buttons" style="">
                <i class="material-icons">chevron_right</i>
            </li>
            <li class="nav-item sys-pd-l-10 application-sub-title fusion-main-page-buttons" style="">HOME MENU</li>
        </ul>
        <ul class="nav navbar-nav navbar-right sys-fg-primary">
            <li class=" nav-item">
                <a href="#" class="text-primary fusion-main-page-buttons nav-link fusion-current-account offcanvas-toggle js-offcanvas-has-events" onclick="sysproInterop.bindAvantiNotifications($('#fusion-sidebar-wrapper2'));" style="" data-toggle="offcanvas" data-target="#offcanvas-avanti-notifications">
                    <i class="material-icons">notifications</i>
                    <span class="badge sys-bg-danger avanti-notifications-count" style="display: none;"></span>
                </a>
            </li>

            <li class="dropdown nav-item">
                <a href="#" class="text-primary fusion-main-page-buttons nav-link fusion-current-account" data-toggle="dropdown" style=""><i class="material-icons">account_circle</i>
                    <span class="hidden-xs fusion-current-account-name">SYSPRO Administrator</span></a>
                <ul class="dropdown-menu multi-level nav sys-pd-t-5" role="menu">
                    <li>
                        <a href="#" class="syspro-toolbar-widget" onclick="sysproInterop.callPlugin('SRSMain', 'SRSQUE');"><i class="material-icons">list</i>Report Queue</a>
                    </li>
                    <li>
                        <a href="#" class="syspro-toolbar-widget" onclick="sysproInterop.showHelp();"><i class="material-icons">help</i>Help</a>
                    </li>
                    <li class="dropdown-submenu">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="#"><i class="material-icons">palette</i>Themes</a>
                        <ul class="dropdown-menu sys-pd-t-5">
                            <li>
                                <a href="#" class="avant-theme-switch" data-themename="light" onclick="sysproInterop.setTheme(this);"><i class="material-icons sys-mg-r-5 sys-fg-white">check</i>Light</a>
                            </li>
                            <li>
                                <a href="#" class="avant-theme-switch" data-themename="dark" onclick="sysproInterop.setTheme(this);"><i class="material-icons sys-mg-r-5 sys-fg-white">check</i>Dark</a>
                            </li>
                            <li>
                                <a href="#" class="avant-theme-switch" data-themename="syspro-light" onclick="sysproInterop.setTheme(this);"><i class="material-icons sys-mg-r-5 sys-fg-success">check</i>Pastel</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="syspro-toolbar-widget" onclick="sysproInterop.closeSYSPROFusion(true);"><i class="material-icons">power_settings_new</i> Sign out</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
  </nav>


  <span id="errorNotification" style="display:none;"></span>
  <span id="taskdialognotification" style="display:none;"></span>
  <span id="aiSuggestionNotification" style="display:none;"></span>
  <div id="dialog"></div>
  <div id="invisibleNodes"></div>

  <div id="fusion-wrapper">
    <div id="harness-container">
      <div id="wrapper" class="toggled">
        <nav nav="" id="navbar-toolbar" class="navbar navbar-default navbar-static-top navbar-controlbar sys-mg-off-b syspro-toolbar ">
          <div class="container-fluid">

          </div>
        </nav>
        <div class="container-fluid container-id-holder" id="main-container" style="padding-top: 40px;">
           
          <!-- Error Notification empty element -->
          <span id="errorNotification" style="display:none;"></span>
          <div class="row sys-mg-t-15">    
            <div class="col-sm-8 col-12 column-parent">
              <div class="panel sys-bd-off sys-box-shadow-off">
                  <div class="row widget layout-widget grid-stack-item-content ps" >
                     <div class="col-sm-12 ">
                        <div class="panel card sys-widget sys-box-shadow-off " >               
                           <div class="panel-body card-body sys-pd-15">
                              <h2 class="sys-300">Michaelson Cycles usually pays on time, but their most recent invoice is 25 days overdue. Sales to this customer are up 24% year on year. 
                                 <i 
                                    class="material-icons davinciicon-light daVinciPopoverTrigger"
                                    data-bs-toggle="popover" 
                                    data-bs-custom-class="daVinciPopover"
                                    data-content-id="summary"
                                    data-bs-content="This summary was written by DaVinci."
                                 >auto_awesome</i>
                              </h2>
                              <div id="chart"></div>
                           </div>
                        </div>
                     </div>
                  </div>
              </div>

              <div class="panel sys-bd-off sys-box-shadow-off">
               <div class="row widget layout-widget grid-stack-item-content" >
           
               <div class="col-sm-12">
           
                   <div class="panel card sys-widget sys-box-shadow-off    ">                      
           
                       <div class="panel-body card-body sys-pd-10">
                           <form class="form-horizontal" max-width="539px" style="position: relative;">
                                            
                               <div class="row" data-row="0">
                                   <div class="col-xs-12 col-6 data-section" data-section="0">
           
                                       <div class="form-group row is-empty sys-mg-b-10" data-guid="6d63aa1b-0f74-4513-dcbf-52c580965d39"
                                           data-bind="hidden: Fields.IMP040L3CustomerPurchaseOrder.Hidden">
           
           
           
                                           <label for="  Customer purchase order"
                                               class="col-md-5 control-label col-form-label sys-mg-t-5 sys-pd-t-5">
                                               <span
                                                   data-bind="htmltextnonull: Fields.IMP040L3CustomerPurchaseOrder.Caption">Customer
                                                   purchase order</span>
                                               <span class="text-warning mandatory-indication">*</span>
                                           </label>
                                           <div class="col-md-6 col-xs-11 col-11 syspro-entry-content">
                                               <input type="text"
                                               value="AI generated value"
                                                   class="form-control syspro-trackfield-input syspro-trackfield-keydown syspro-trackfield-change syspro-focusable syspro-supports-mask davincifield"
                                                   id="Fields.IMP040L3CustomerPurchaseOrder">
           
           
           
                                           </div>
           
           
                                       </div>
                      
                                       <div class="form-group row is-empty" data-guid="3c8bfbc4-6f28-4733-b2fc-2b3a8ff2ef38"
                                           data-bind="hidden: Fields.IMP040L3OrderDate.Hidden">
           
           
           
                                           <label for="  Order date"
                                               class="col-md-5 control-label col-form-label sys-mg-t-5 sys-pd-t-5">
                                               <span data-bind="htmltextnonull: Fields.IMP040L3OrderDate.Caption">Order date</span>
                                           </label>
                                           <div class="col-md-6 col-xs-11 col-11 syspro-entry-content">
                                               <div class="input-group date">
                                                   <input type="text"
                                                       class="form-control date-input syspro-focusable syspro-trackfield-change"
                                                       placeholder="Enter date" id="Fields.IMP040L3OrderDate">
                                                   <span class="input-group-addon input-group-prepend input-group-append">
                                                       <i class="material-icons text-primary">date_range</i>
                                                   </span>
                                               </div>
           
           
                                           </div>
           
                                       </div>
                                                             
                                   </div>
                                   <div class="col-xs-12 col-6 data-section" data-section="0">
                                    <div class="form-group row is-empty" data-guid="3deea910-592f-4a58-eaa6-c3d9b82c2302"
                                    data-bind="hidden: Fields.IMP040L3ShipDate.Hidden">                      
    
                                       <label for="  Ship date"
                                          class="col-md-5 control-label col-form-label sys-mg-t-5 sys-pd-t-5">
                                          <span data-bind="htmltextnonull: Fields.IMP040L3ShipDate.Caption">Ship date</span>
                                       </label>
                                       <div class="col-md-6 col-xs-11 col-11 syspro-entry-content">
                                          <div class="input-group date">
                                             <input type="text"
                                                   class="form-control date-input syspro-focusable syspro-trackfield-change davincifield"
                                                   placeholder="Enter date" id="Fields.IMP040L3ShipDate" value="10/10/2023">
                                                   
                                             <span class="input-group-addon input-group-prepend input-group-append">
                                                   <i class="material-icons text-primary">date_range</i>
                                             </span>
                                          </div>
      
      
                                       </div>
        
                                </div>

                                   </div>
                               </div>
           
                           </form>
                      
                       </div>
                   </div>
               </div>
           
           </div>
           <div class="row widget layout-widget grid-stack-item-content" >           
               <div class="col-sm-12">
                  <div class="panel card sys-widget sys-box-shadow-off    ">                              
                     <div class="panel-body card-body sys-pd-10">
                        <div id="confGrid"></div>
                     </div>
                  </div>
               </div>

              </div>
              </div>
            </div>
            <div class="col-sm-4 col-12 column-parent">
              <div class="panel sys-bd-off sys-box-shadow-off">
                <div class="panel-body main-column">
                  <div class="row widget layout-widget grid-stack-item-content ps" data-guid="a67c49bb-8305-4026-9613-3c76c74e2859" data-subtype="" data-border="Internal" data-displaystyle="Tiles" data-collapsible="False" style="" >
                     <div class="col-sm-12 tile-widget-wrapper">

                              <div class="panel card sys-widget sys-box-shadow-off    tiles-parent" data-role="droptarget" style="margin-bottom: 0px;">               
                                 <div class="panel-body card-body sys-pd-off">

                     <div class="row sys-tbl" data-row="0">
                        <div class="col-xs-12 col-12  sys-bg-white">
                              <div class="row tile-widget" style="position: relative; width: 426px; height: 299px;">
                                 <div class="tile tile-width-marker col-sm-4 col-xs-6 col-6"></div>


                     <div class="col-sm-4 col-xs-6 col-6 tile " data-tiletype="Text" data-tiletypename="ARS014_Ave_Days_to_Pay_By_Customer" data-tiletypedetail="TILE_a340c557b8244efba9cf8e1db4ce25da" data-parentfieldpath="Customer" data-tileparameters="{&quot;Customer&quot;:&quot;&quot;}" data-tiledetailavailable="Y" style="position: absolute; left: 0px; top: 5px;" data-boundonce="true">
                        
                              <div class="tile-loading-cover" style="display: none;"><span class="spinner"></span></div>
                        <div>
                              <div class="tile-inner sys-fg-white sys-bg-lighter-blue">
                                 <div class="panel-body text-left sys-wrapper sys-pd-off sys-mg-off">
                     <div class="big-tile row" data-bind="tilecolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Title">Avg. Days to Pay</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.SubTitle">Customer:</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage, text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half flex-center">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon text-white sys-fg-white main-tile-icon" data-bind="tileicon: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Icon, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.IconColor"></i>
                                 </div>
                                 <span class="tile-value-label text-right" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Value, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>                
                              </div>
                        </div>
                     </div>

                     <div class="wide-tile row" data-bind="tilecolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Title">Avg. Days to Pay</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.SubTitle">Customer:</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage, text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <i class="material-icons tile-icon text-left main-tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Icon, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.IconColor"></i>
                                 <div class="valueWrapper text-right">
                                    <span class="text-right tile-value-label" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Footer"></span>
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Value, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                     <div class="small-tile row" data-bind="tilecolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <div class="ai-tile-icon-title">
                                    <span class="text-left tile-title">Avg. Days to Pay</span>
                                    <i class="material-icons pull-right text-right sys-txt-sm daVinciDataPopoverTrigger" data-bs-toggle="popover" 
                                    data-bs-custom-class="daVinciPopover"
                                    data-content-id="tile"
                                    data-bs-content="Future data predicted by Da Vinci.">auto_awesome</i>
                                 </div>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.SubTitle">Customer:</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage, text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Icon, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.IconColor"></i>
                                 </div>
                                 <span class="text-right tile-value-label" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value text-right" data-bind="text: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.Value, tileiconcolor: Query.TILE_a340c557b8244efba9cf8e1db4ce25da.ValueColor" style="white-space: nowrap; display: inline-block; font-size: 30px;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                  </div>

                              </div>
                        </div>
                     </div>


                     <div class="col-sm-4 col-xs-6 col-6 tile " data-tiletype="Text" data-tiletypename="WHM007_Missions_completed_today" data-tiletypedetail="TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a" data-parentfieldpath="Mission" data-tileparameters="{}" data-tiledetailavailable="Y" style="position: absolute; left: 142px; top: 5px;" data-boundonce="true">
                        
                              <div class="tile-loading-cover" style="display: none;"><span class="spinner"></span></div>
                        <div>
                              <div class="tile-inner sys-fg-white sys-bg-lighter-blue">
                                 <div class="panel-body text-left sys-wrapper sys-pd-off sys-mg-off">
                     <div class="big-tile row" data-bind="tilecolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Title">Missions completed today</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage, text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half flex-center">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon text-white sys-fg-white main-tile-icon" data-bind="tileicon: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Icon, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.IconColor"></i>
                                 </div>
                                 <span class="tile-value-label text-right" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Value, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>                
                              </div>
                        </div>
                     </div>

                     <div class="wide-tile row" data-bind="tilecolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Title">Missions completed today</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage, text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <i class="material-icons tile-icon text-left main-tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Icon, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.IconColor"></i>
                                 <div class="valueWrapper text-right">
                                    <span class="text-right tile-value-label" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Footer"></span>
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Value, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                     <div class="small-tile row" data-bind="tilecolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title show-more-icon" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Title" style="height: 32px;">Missions completed today</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage, text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Icon, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.IconColor"></i>
                                 </div>
                                 <span class="text-right tile-value-label" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value text-right" data-bind="text: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.Value, tileiconcolor: Query.TILE_a3afe1b0226a43a0a7eb78a5c91cdc0a.ValueColor" style="white-space: nowrap; display: inline-block; font-size: 30px;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                  </div>

                              </div>
                        </div>
                     </div>


                     <div class="col-sm-4 col-xs-6 col-6 tile " data-tiletype="Text" data-tiletypename="SQL003_Table_Sizes" data-tiletypedetail="TILE_a41a4ea9c75b4138859cfd495f465df2" data-parentfieldpath="" data-tileparameters="{&quot;Number_Of_Tables&quot;:&quot;&quot;}" data-tiledetailavailable="Y" style="position: absolute; left: 284px; top: 5px;" data-boundonce="true">
                        
                              <div class="tile-loading-cover" style="display: none;"><span class="spinner"></span></div>
                        <div>
                              <div class="tile-inner sys-fg-white sys-bg-lighter-blue">
                                 <div class="panel-body text-left sys-wrapper sys-pd-off sys-mg-off">
                     <div class="big-tile row" data-bind="tilecolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Title">Top Tables by Size</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.SubTitle"></span>
                                 
                              </div>
                              <div class="tile-bottom-half flex-center">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon text-white sys-fg-white main-tile-icon" data-bind="tileicon: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Icon, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.IconColor"></i>
                                 </div>
                                 <span class="tile-value-label text-right" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Footer">Top  tables</span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Value, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.ValueColor" style="white-space: nowrap; display: inline-block;">0 MB</span>
                                 </div>                
                              </div>
                        </div>
                     </div>

                     <div class="wide-tile row" data-bind="tilecolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Title">Top Tables by Size</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.SubTitle"></span>
                                 
                              </div>
                              <div class="tile-bottom-half">
                                 <i class="material-icons tile-icon text-left main-tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Icon, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.IconColor"></i>
                                 <div class="valueWrapper text-right">
                                    <span class="text-right tile-value-label" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Footer">Top  tables</span>
                                    <span class="tile-main-value" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Value, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.ValueColor" style="white-space: nowrap; display: inline-block;">0 MB</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                     <div class="small-tile row" data-bind="tilecolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title show-more-icon" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Title" style="height: 32px;">Top Tables by Size</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.SubTitle"></span>
                                 
                              </div>
                              <div class="tile-bottom-half">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Icon, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.IconColor"></i>
                                 </div>
                                 <span class="text-right tile-value-label" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Footer">Top  tables</span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value text-right" data-bind="text: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.Value, tileiconcolor: Query.TILE_a41a4ea9c75b4138859cfd495f465df2.ValueColor" style="white-space: nowrap; display: inline-block; font-size: 30px;">0 MB</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                  </div>

                              </div>
                        </div>
                     </div>


                     <div class="col-sm-4 col-xs-6 col-6 tile " data-tiletype="Text" data-tiletypename="WHM004_Missions_by_Pick" data-tiletypedetail="TILE_aedb098175a04be3803a53be736fca66" data-parentfieldpath="Mission" data-tileparameters="{}" data-tiledetailavailable="Y" style="position: absolute; left: 0px; top: 152px;" data-boundonce="true">
                        
                              <div class="tile-loading-cover" style="display: none;"><span class="spinner"></span></div>
                        <div>
                              <div class="tile-inner sys-fg-white sys-bg-lighter-red">
                                 <div class="panel-body text-left sys-wrapper sys-pd-off sys-mg-off">
                     <div class="big-tile row" data-bind="tilecolor: Query.TILE_aedb098175a04be3803a53be736fca66.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Title">Missions by Pick</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage, text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half flex-center">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon text-white sys-fg-white main-tile-icon" data-bind="tileicon: Query.TILE_aedb098175a04be3803a53be736fca66.Icon, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.IconColor"></i>
                                 </div>
                                 <span class="tile-value-label text-right" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Value, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>                
                              </div>
                        </div>
                     </div>

                     <div class="wide-tile row" data-bind="tilecolor: Query.TILE_aedb098175a04be3803a53be736fca66.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Title">Missions by Pick</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage, text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <i class="material-icons tile-icon text-left main-tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_aedb098175a04be3803a53be736fca66.Icon, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.IconColor"></i>
                                 <div class="valueWrapper text-right">
                                    <span class="text-right tile-value-label" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Footer"></span>
                                    <span class="tile-main-value" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Value, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.ValueColor" style="white-space: nowrap; display: inline-block;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                     <div class="small-tile row" data-bind="tilecolor: Query.TILE_aedb098175a04be3803a53be736fca66.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <div class="ai-tile-icon-title">
                                    <span class="text-left tile-title">Missions by Pick</span>
                                    <i class="material-icons pull-right text-right sys-txt-sm daVinciDataPopoverTrigger" data-bs-toggle="popover" 
                                    data-bs-custom-class="daVinciPopover"
                                    data-content-id="tile"
                                    data-bs-content="Future data predicted by Da Vinci.">auto_awesome</i>
                                 </div>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.SubTitle">Mission</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage, text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_aedb098175a04be3803a53be736fca66.Icon, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.IconColor"></i>
                                 </div>
                                 <span class="text-right tile-value-label" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Footer"></span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value text-right" data-bind="text: Query.TILE_aedb098175a04be3803a53be736fca66.Value, tileiconcolor: Query.TILE_aedb098175a04be3803a53be736fca66.ValueColor" style="white-space: nowrap; display: inline-block; font-size: 30px;">0</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                  </div>

                              </div>
                        </div>
                     </div>


                     <div class="col-sm-4 col-xs-6 col-6 tile " data-tiletype="Text" data-tiletypename="WIP960_Wip_At_A_Glance_Lab_Issued" data-tiletypedetail="TILE_f016bb843942492ca41737f24c86bccb" data-parentfieldpath="" data-tileparameters="{&quot;PeriodCP1P2&quot;:&quot;C&quot;}" data-tiledetailavailable="Y" style="position: absolute; left: 142px; top: 152px;" data-boundonce="true">
                        
                              <div class="tile-loading-cover" style="display: none;"><span class="spinner"></span></div>
                        <div>
                              <div class="tile-inner sys-fg-white sys-bg-lighter-red">
                                 <div class="panel-body text-left sys-wrapper sys-pd-off sys-mg-off">
                     <div class="big-tile row" data-bind="tilecolor: Query.TILE_f016bb843942492ca41737f24c86bccb.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Title">WIP at a glance</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.SubTitle">Labor issued</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessage, text: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half flex-center">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon text-white sys-fg-white main-tile-icon" data-bind="tileicon: Query.TILE_f016bb843942492ca41737f24c86bccb.Icon, tileiconcolor: Query.TILE_f016bb843942492ca41737f24c86bccb.IconColor"></i>
                                 </div>
                                 <span class="tile-value-label text-right" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Footer">Period:Current</span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Value, tileiconcolor: Query.TILE_f016bb843942492ca41737f24c86bccb.ValueColor" style="white-space: nowrap; display: inline-block;">38416.05</span>
                                 </div>                
                              </div>
                        </div>
                     </div>

                     <div class="wide-tile row" data-bind="tilecolor: Query.TILE_f016bb843942492ca41737f24c86bccb.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <span class="text-left tile-title" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Title">WIP at a glance</span>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.SubTitle">Labor issued</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger" data-bind="visible: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessage, text: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessage" style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.ErrorMessageLong"></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <i class="material-icons tile-icon text-left main-tile-icon sys-fg-primary" data-bind="tileicon: Query.TILE_f016bb843942492ca41737f24c86bccb.Icon, tileiconcolor: Query.TILE_f016bb843942492ca41737f24c86bccb.IconColor"></i>
                                 <div class="valueWrapper text-right">
                                    <span class="text-right tile-value-label" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Footer">Period:Current</span>
                                    <span class="tile-main-value" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Value, tileiconcolor: Query.TILE_f016bb843942492ca41737f24c86bccb.ValueColor" style="white-space: nowrap; display: inline-block;">38416.05</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                     <div class="small-tile row" data-bind="tilecolor: Query.TILE_f016bb843942492ca41737f24c86bccb.TileColor">
                        <div class="col-xs-12 col-12">
                              <div class="tile-top-half">
                                 <div class="ai-tile-icon-title">
                                    <span class="text-left tile-title">WIP at a glance</span>
                                    <i class="material-icons pull-right text-right sys-txt-sm daVinciDataPopoverTrigger" data-bs-toggle="popover" 
                                    data-bs-custom-class="daVinciPopover"
                                    data-content-id="tile"
                                    data-bs-content="Future data predicted by Da Vinci.">auto_awesome</i>
                                 </div>
                                 <span class="tile-subtitle" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.SubTitle">Labor issued</span>
                                 <span class="tile-subtitle tile-error tile-error-short sys-fg-danger"  style="display: none;"></span>
                              <span class="tile-subtitle tile-error tile-error-long sys-fg-danger" ></span>
                              </div>
                              <div class="tile-bottom-half">
                                 <div class="mainIconWrapper text-center">
                                    <i class="material-icons text-left tile-icon sys-fg-primary" ></i>
                                 </div>
                                 <span class="text-right tile-value-label" data-bind="text: Query.TILE_f016bb843942492ca41737f24c86bccb.Footer">Period:Current</span>
                                 <div class="valueWrapper text-right metric-only">
                                    <span class="tile-main-value text-right" style="white-space: nowrap; display: inline-block; font-size: 26.25px;">38416.05</span>
                                 </div>
                              </div>
                        </div>
                     </div>
                  </div>

                              </div>
                        </div>
                     </div>

                              </div>
                        </div>
                     </div>


                                 </div>
                              </div>
                     </div>

                  </div>
                  <hr class="sys-bd-very-light-gray" />
                  <div class="row widget layout-widget grid-stack-item-content ps" data-guid="a67c49bb-8305-4026-9613-3c76c74e2859" data-subtype="" data-border="Internal" data-displaystyle="Tiles" data-collapsible="False" style="" >
                     <div class="col">
                        <h4><i class="material-icons">queue</i> Purchase Order bulk creation <i 
                           class="material-icons davinciicon-light daVinciAutoPopoverTrigger"
                           data-bs-toggle="popover" 
                           data-bs-custom-class="daVinciPopover"
                           data-content-id="automation"
                           data-bs-content="This is a Da Vinci Vision automated process"
                           data-bs-title="Da Vinci automated process."
                        >auto_awesome</i></h4>   
                        <small>Upload multiple invoices at once, and Da Vinci Vision will automatically create Purchase Orders from them.</small>                  
                        <div class="fileUploadDropZone sys-mg-t-5">
                           <input name="files" id="files" type="file" />
                     </div>
                     </div>
                  </div>
                </div>
              </div>
            </div>            

        </div>
      </div>
      <div class="statusBar sys-bg-inverse" style="display: block;">
        <span class="status-message sys-fg-very-light-gray">The OUTDOORS Company (EDU1)  Your license expires February 1st           TUESDAY 8   JANUARY 2019</span>
      </div>
    </div>

    <button id="davinciButton"><i class="material-icons">auto_awesome</i></button>
    


    <footer id="thefooter" style="background-image: url('../../Samples/UX_IMG_cloud_erp_light_footer.png');">
      <span id="copyrightfooter">© SYSPRO All Rights Reserved. All trademarks are recognized.</span><span id="sysprofooter">Powered by SYSPRO ERP</span>
    </footer>

  </div>

   <div id="daVinciWindow">
      <div id="daVinciChat" style="width: 100%; height: 100%"></div>
   </div>
   <ul id="faves-menu">
      <li>Analyse the number of orders for each month in 2022, and the number of orders in each month in 2023.</li>
      <li>I want to create a new quote</li>
      <li>Can you analyze any trends in sales to Brian Zurich over the past 5 years?</li>
      <li>show me the job card for the "ROYAL GALA FANCY 12 x 3 LB (R)" job</li>
      <li>get me the top 4 customers, ranked by current balance and show it as a pie chart</li>
      <li>which salesperson has the most orders?</li>
      <li>show me the card for product 06-01-52-2-9910</li>
      <li>Can you give me the product code, description, category and warehouse for product codes 06-01-10-2-9910, 06-01-52-2-9910, 06-01-51-2-9910 and 06-01-60-2-9910</li>
      <li>from the warehouses table get the top 5 product codes ranked by quantity sold, and show this as a column chart</li>
      <li>what are the contact details and address (including city and postal code) for customer Brian Zurich</li>
      <li>what program should I use to look up information about inventory?</li>
      <li>find the top four products by quantity on hand, and then list the product code, description, warehouse and quantity on hand </li>
      <li>What is product 06-01-60-2-9910</li>
      <li>which other products are commonly ordered with 06-01-60-2-9910?</li>
      <li>What are the orders with 06-01-99-2-9999 and 06-01-60-2-9910?</li>
      <li>can you analyse sales to Marko Smith over the past 3 years</li>
      <li>can you show the sales to this customer monthly for the past 2 years as a line chart</li>

  </ul>
   <div style="display: none" id="recordViewMenus">
      
   </div>
  <script src="js/new/UX_JS_bootstrap.min.js"></script>
  <script src="js/UX_JS_forms.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
  <script src="js/html2canvas.min.js"></script>
  <script src="js/jspdf.umd.min.js"></script>
  <script src="js/MaterialIcons-Regular-normal.js"></script>
  
  <script id="davinciresponse-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header d-flex justify-content-between">
         <div class="">
            #:title#
         </div>
         <div class="">
            <i class="material-icons sys-fg-gray sys-mg-r-10 showmodelcard" data-bs-toggle="tooltip" data-bs-title="Da Vinci Data Prediction">insights</i>
            <span class="conflevel">
            <i class="material-icons sys-fg-warning" data-bs-toggle="tooltip" data-bs-title="Confidence level">data_usage</i>
            <span class="sys-txt-sm sys-fg-gray">61%</span>
            </span>
         </div>
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="Please provide more technical information.">Technical info</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="There's something wrong with this.">Something's wrong</span>
         </span>
     </div>
   </div>
 </script>
 <script id="davincisumresponse-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header d-flex justify-content-between">
         <div class="">
            #:title#
         </div>
         <div class="">
            <i class="material-icons sys-fg-gray sys-mg-r-10 showmodelcard" data-bs-toggle="tooltip" data-bs-title="Da Vinci Text Generation">edit_note</i>
            <span class="conflevel">
            <i class="material-icons sys-fg-success" data-bs-toggle="tooltip" data-bs-title="Confidence level">data_usage</i>
            <span class="sys-txt-sm sys-fg-gray">84%</span>
            </span>
         </div>
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="Please provide more technical information.">Technical info</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="There's something wrong with this.">Something's wrong</span>
         </span>
     </div>
   </div>
 </script>

 <script id="davincitileresponse-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header d-flex justify-content-between">
         <div class="">
            #:title#
         </div>
         <div class="">
            <i class="material-icons sys-fg-gray sys-mg-r-10 showmodelcard" data-bs-toggle="tooltip" data-bs-title="Da Vinci Data Prediction">insights</i>
            <span class="conflevel">
            <i class="material-icons sys-fg-warning" data-bs-toggle="tooltip" data-bs-title="Confidence level">data_usage</i>
            <span class="sys-txt-sm sys-fg-gray">65%</span>
            </span>
         </div>
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="Please provide more technical information.">Technical info</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="There's something wrong with this.">Something's wrong</span>
         </span>
     </div>
   </div>
 </script>

 <script id="davinciautoresponse-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header d-flex justify-content-between">
         <div class="">
            #:title#
         </div>
         <div class="">
            <i class="material-icons sys-fg-gray showmodelcard" data-bs-toggle="tooltip" data-bs-title="Da Vinci Automated Process">smart_toy</i>
         </div>
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="Please provide more technical information.">Technical info</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-sm k-rounded-md k-button-flat k-button-flat-base" data-value="There's something wrong with this.">Something's wrong</span>
         </span>
     </div>
   </div>
 </script>

 <script id="technicalinfo-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header">
         Technical info
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
   </div>
 </script>

 <script id="sysprolearn-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header">
         Help on using SYSPRO
     </div>
     <div class="k-card-body">
       <p>#=content#</p>
     </div>
   </div>
 </script>

 <script id="confidence-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header">
         Confidence levels
     </div>
     <div class="k-card-body">
       <p>A description of confidence levels and what they mean.</p>
       <table class="table">
         <tr>
            <td style="width: 5%"><i class="material-icons sys-fg-success">data_usage</i></td>
            <td><b>Over 75%</b></td>
         </tr>
         <tr>
            <td><i class="material-icons sys-fg-warning">data_usage</i></td>
            <td><b>55% - 75%</b></td>
         </tr>
         <tr>
            <td><i class="material-icons sys-fg-danger">data_usage</i></td>
            <td><b>Under 55%</b></td>
         </tr>
       </table>
     </div>
   </div>
 </script>

 <script id="models-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header">
         Confidence levels
     </div>
     <div class="k-card-body">
       <p>Da Vinci has three main tools it uses to help you understand your data, increase efficiency, and to run your operations more easily and speedily. Each type of tool is indicated by an icon that you might see when using SYSPRO.</p>
       <table class="table table-borderless models-table">
         <tr>
            <td><i class="material-icons sys-txt-lg sys-fg-gray">edit_note</i></td>
            <td>
               <h4 class="sys-mg-b-5"><b>Text Generation</b></h4>
               <p>A description of the LLM and natural languange processing capabilities of SYSPRO AI.</p>
            </td>
         </tr>
         <tr>
            <td><i class="material-icons sys-txt-lg sys-fg-gray">insights</i></td>
            <td>
               <h4 class="sys-mg-b-5"><b>Data Insights</b></h4>
               <p>A description of the data prediction and anomaly detection capabilities.</p>
            </td>
         </tr>
         <tr>
            <td><i class="material-icons sys-txt-lg sys-fg-gray">smart_toy</i></td>
            <td>
               <h4 class="sys-mg-b-5"><b>Task Automation</b></h4>
               <p>A description of automation, including OCR capabilities of Da Vinci.</p>
            </td>
         </tr>
       </table>
     </div>
   </div>
 </script>

 <script id="davinciconfirm-template" type="text/x-kendo-template">
   <div class="k-card">
      <div class="k-card-header sys-bg-success sys-fg-white">
         #:title#
     </div>
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-md k-rounded-md k-button-flat k-button-flat-base" data-value="Go ahead">Go ahead</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-md k-rounded-md k-button-flat k-button-flat-base sys-bg-very-light-gray sys-fg-inverse" data-value="There's something wrong with this.">Cancel</span>
         </span>
     </div>
   </div>
   
 </script>

 <script id="olddavinciconfirmed-template" type="text/x-kendo-template">
   <div class="k-card sys-bg-success sys-fg-white">
     <div class="k-card-body">
       <p>#:content#</p>
     </div>
     <div class="k-card-actions k-card-actions-end">
         <span class="k-card-action">
            <span class="k-button k-button-md k-rounded-md k-button-flat k-button-flat-base" data-value="Please provide more technical information.">Go ahead</span>
         </span>
         <span class="k-card-action">
            <span class="k-button k-button-md k-rounded-md k-button-flat k-button-flat-base sys-bg-very-light-gray sys-fg-inverse" data-value="There's something wrong with this.">Cancel</span>
         </span>
     </div>
   </div>
   
 </script>
 <script id="davinciconfirmed-template" type="text/x-kendo-template">
   <p>#= content #</p>
 </script>

 <script id="davincicode-template" type="text/x-kendo-template">
   <pre><code>Imports System.Drawing

' Get the current year's sales total and the previous year's sales total
Dim currentYearSales As Decimal = ARSPEN.SalesTotal
Dim previousYearSales As Decimal = GetPreviousYearSales() ' You should implement this function

' Define your color constants
Dim greenColor As Color = Color.Green
Dim redColor As Color = Color.Red

' Check if the current year's sales total is greater than the previous year's
If currentYearSales > previousYearSales Then
    ' Set the text color to green
    ARSPEN.SalesTotal.ForeColor = greenColor
ElseIf currentYearSales <code previousYearSales Then
    ' Set the text color to red
    ARSPEN.SalesTotal.ForeColor = redColor
Else
    ' You can set a default color (e.g., black) if they are equal or handle this case differently
    ARSPEN.SalesTotal.ForeColor = Color.Black
End If

' Update the text to display the current year's sales total
ARSPEN.SalesTotal.Text = currentYearSales.ToString()

' Implement a function to get the previous year's sales total (replace with your data retrieval logic)
Function GetPreviousYearSales() As Decimal
    ' Replace this with your actual data retrieval logic
    ' For example, you could query a database or calculate it based on your data
    ' For demonstration purposes, we'll return a hardcoded value
    Return 10000.0 ' Replace with your actual value
End Function</code></pre>
 </script>

<script>   

   const systemPrompt = `Your name is 'Da Vinci', you are the 'Syspro AI helper'. Introduce yourself as such, and answer as such if asked. Always use a friendly but professional tone.         

Your main responsibilities are to retrieve data from Syspro, make tasks easier, help people use Syspro, and to make data easier to digest by summarising and visualising.

Often you will have to do a SQL query in order to respond to a query. ALWAYS use SQL Server syntax, NOT MySQL syntax. Don't ever mention you are executing a SQL query. If you have some problems matching what I ask to SQL table and columns, just make the best match you can, execute a query that will work, and return the results. Don't tell me about what you have changed, and don't tell me if you have having difficulties or misunderstandings, that's not a problem. Just execute the query without me knowing any of the details, and return the best results you can.

You might be asked to query things that don't match exactly to table and columns. Here are some specific examples:
If asked to search 'warehouses' then that is the 'warehouses' table. But if asked for the warehouse for a specific product or product code, then use the column 'warehouse_id'. If asked for 'product', then use the column 'product_id' which is in both the 'products' table, and the 'warehouses' table. If asked for 'post code' or 'zip' or 'zip code' then this is the column 'postal_code' in the 'customers' table.

If your response will include multiple rows from a SQL query (2 or more rows), each of which having 2 or more columns of data, then return the data as JSON. Immediately before the JSON and before any of your response that wraps the JSON, include the text 'KendoGrid: Here starts JSON:' (without any other characters), and then include no further text after the JSON. For column titles, always replace underscores (_) with a space. DO NOT return any other kind of table with your own formatting. Very importantly (!), NEVER insert a line like '// Additional rows have been omitted for brevity' into the JSON, because it makes JSON invalid. Instead, if there are more than about 40 rows, provide some text before the JSON saying that you have only included the first X number of rows. NB: Always follow this rule when returning JSON for anything. Follow these instructions if your answer includes multiple orders, products, customers, invoices, jobs, or multiple of any other record.

Again, if your response includes 2 or more rows from a SQL query, with 2 or more columns, DO NOT return a normal text response with all the data, but return it as JSON, following the instructions I just gave you.

With any response, at the end, provide some 'suggested queries' by following the instructions given later. Please remember this.

If asked to 'tell me about', 'analyse', or 'explain' some data, then make the relevant queries to get the data, and then write a paragraph in a professional, business report style. Explain any trends in the data over time, any anomalies, and compare similar time periods if relevant (for example the same month in differnt years, if that is in the requested data). Above all, answer any specific questions in the request. If asked to analyse some 'order' data, then query the 'order' and 'order_details' tables to get the data. Include actual numbers and dates from the database as examples, where relevant.

When asked for information about products, or a product, they can be identified in the databases with 'product_id' as the unique identifier, in both the 'warehouses' and 'products' tables. If asked about the product description, long decription or category, then look up by "product_id" in the "products" table. If asked about quantity on hand, quantity sold, warehouse or cost, then look that up by "product_id" in the "warehouses" table. If asked for a combination of those things then you will need to get some data from the 'products' table, and some from the 'warehouses' table. For example if asked for the product code, description, warehouse and quantity on hand, you will need to use the "product_id" as the unique identifier to look up that information from both the "products" table, and the "warehouses" table. To be specific, only ever query these following columns from the "products" table: "product_id", "LongDesc", "warehouse_id" and "category" - NEVER query any other columns from the "products" table. "LongDesc" is the column for the description. Only ever query these following columns from the "warehouses" table: "product_id", "quantity_on_hand", "quantity_sold", "warehouse_id" and "cost" - NEVER query any other columns (e.g. "Description") from the "warehouses" table. If you need data from both the "products" table, and from the "warehouses" table for the same "product_id" then you need to do a SQL JOIN query, or similar. NB: if your answer will include multiple rows of product data, then follow the previous instructions about responding with JSON.

If asked about an order, or orders, then query the 'orders' and/or the 'order_details' table. In the 'orders' table ONLY query the following columns: 'order_id', 'status', 'customer_id', 'customer_name', 'Salesperson', 'ship_address', 'ship_city', 'ship_region', 'ship_country', 'ship_postal_code', 'order_date', 'order_year', 'order_type', 'purchase_order_number', 'Email'. NEVER attempt to query any other columns in the 'orders' table. in the 'order_details' table ONLY query the following columns: 'order_id', 'order_line_number', 'order_date', 'order_year', 'product_id', 'product_name', 'product_type', 'warehouse_id', 'quantity', 'back_order_quantity', 'invoice_quantity', 'cost', 'uom' and 'unit_price'. Do NOT attempt to query any other columns from the 'order_details' table. An individual order is identified by the 'order_id'. Query the 'orders' table if asked about salespeople or a sales person etc., as explained in the next paragraph. NB: if your answer will include multiple rows of order data, then also follow the previous instructions about responding with JSON.

If asked about a single specific order, or if your response to a query is one specific order, then use the following instructions and HTML template below. You will need to perform a SQL query on the 'orders' table to get all the data, probably using the 'order_id' as the unique identifier. When you have all that data, then return the following HTML template, but with the placeholders shown by the column preceded by a '$' replaced by the relevant value. For example replace '$order_type' with the value you get for 'order_type' from the 'orders' table. Here is the HTML template to use, and when you return it, ALWAYS first include the string 'Here starts code:' directly before the HTML, and then return no text at all after the HTML (unless it is 'suggested queries' as described below):

<div class="panel card sys-widget card-widget">
   <div class="card-bindable panel-body card-body sys-pd-off  sys-rd">
      <div class="panel-body card-body text-left sys-wrapper sys-bg-primary sys-fg-white">
         <div class="col-xs-12 col-12">
               <a class="card-header-link sys-fg-white" tabindex="0" onclick="sysproInterop.showSmartTag(this)" data-fieldcaption="sales order"><h3 class="sys-mg-t-3 sys-txt-lg sys-mg-b-5 text-white sys-fg-white pull-left float-left">$order_id</h3></a>
               <small class="text-left sys-fg-white sys-txt-md"><span>$order_type</span> - <span>Type</span></small>
         </div>
      </div>
      <div class="panel-body card-body text-left sys-wrapper sys-bg-white sys-fg-inverse"></div>
      <ul class="nav nav-tabs nav-justified sys-bg-white card-tabs" role="tablist">
         <li class="nav-item"><a class="nav-link active" data-toggle="tab" data-bs-toggle="tab" href="#tabSalesOrderInfo">Info</a></li>
         <li class="nav-item"><a class="nav-link" data-toggle="tab" data-bs-toggle="tab" href="#tabSalesOrderAddress">Address</a></li>
      </ul>
      <div class="tab-content">
         <div id="tabSalesOrderInfo" class="tab-pane fade in show active sys-pd-t-5" role="tabpanel">

               <div class="sys-pd-r-7 sys-pd-l-7 sys-pd-t-5 sys-pd-b-5 sys-bg-white sys-fg-inverse sys-mg-b-5">
                  <div class="row">
                     <div class="col-xs-4 col-4">
                           <div class="sys-rd  ">
                              <div class="row sys-tbl sys-pd-l-15 ">
                                 <div class="col-xs-3 col-3"><i class="material-icons sys-txt-md">print</i></div>
                                 <div class="col-xs-9 col-9"><span class="sys-fg-gray">$status</span> - <span class="sys-fg-gray">Status</span></div>
                              </div>
                           </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class="col-xs-6 col-6 sys-pd-t-15 text-left sys-vcenter">
                           <span class="sys-mg-off sys-txt-md">
                              <span data-bind="source: SorDetail" ><a class="card-header-link" tabindex="0" onclick="sysproInterop.showSmartTag(this)" data-fieldcaption="customer"><span class="sys-500" data-bind="htmltext: Customer">$customer_name</span> - <span class="sys-500" >$customer_id</span></a><small class="text-muted">Customer name</small></span>
                           </span>
                     </div>
                     <div class="col-xs-6 col-6 sys-pd-t-5 text-left sys-vcenter">
                           <span class="sys-mg-off sys-txt-md"><span data-bind="source: SorDetail"><span class="text-left sys-500">$purchase_order_number</span><small class="text-muted">Customer PO number</small></span></span>
                     </div>
                     <div class="col-xs-6 col-6 sys-pd-t-15 sys-pd-b-15 text-left sys-vcenter">
                        <span class="sys-mg-off sys-txt-md sys-500"><a class="card-header-link" tabindex="0" onclick="sysproInterop.showSmartTag(this)" data-fieldcaption="salesperson"><span>$Salesperson</span></a></span>
                        <small class="text-muted">Salesperson</small>
                     </div>
                  </div>
                  <hr class="sys-hr-light-gray sys-mg-t-15 sys-mg-b-15">
                  <h4><i class="material-icons">date_range</i>Dates</h4>
                  <div class="row">
                     <div class="col-xs-6 col-6 sys-pd-t-5 text-left sys-vcenter">
                        <span class="sys-mg-off sys-500"><span class="sys-txt-md">$order_date</span></span>
                        <small class="text-muted">Sales order</small>
                     </div>                    
                  </div>
                  <hr class="sys-hr-light-gray sys-mg-off">
               </div>
         </div>
         <div id="tabSalesOrderAddress" class="tab-pane fade in show sys-pd-t-5" role="tabpanel">
            <div id="salesOrderAddresses" class="carousel slide" data-ride="false" data-bs-ride="false" data-interval="4000" data-bs-interval="4000">
               <div class="carousel-inner">
                  <div class="item carousel-item active">
                        <div class="panel-body card-body sys-rd-t">
                           <h4 class="sys-mg-b-10 "><i class="material-icons">explore</i>Sold to address</h4>
                           <div class="sys-pd-l-20 text-left">
                              <address class="sys-mg-off"><span>$ship_address</span><br><span>$ship_city</span><br><span>$ship_region</span><br><span>$ship_country</span><br><span>$ship_postal_code</span></address>
                           </div>                            
                        </div>
                     </div>
                     <div class="item carousel-item">
                           <div class="panel-body card-body sys-rd-t">
                              <h4 class="sys-mg-b-10 "><i class="material-icons">local_shipping</i>Ship to address</h4>
                              <div class="sys-pd-l-20 text-left">
                                 <address class="sys-mg-off"><span>$ship_address</span><br><span>$ship_city</span><br><span>$ship_region</span><br><span>$ship_country</span><br><span>$ship_postal_code</span></address>
                              </div> 
                           </div>
                     </div>
                  </div>
               </div>
               <hr class="sys-mg-off">
               <div class="panel-body card-body sys-pd-off sys-rd-b" style="overflow: hidden;">
                  <div class="row"><a href="#salesOrderAddresses" class="col-xs-6 col-6 pull-left float-left sys-bg-lighten sys-fg-textcolor sys-pd-t-10 sys-pd-b-10 text-center" data-slide="prev" data-bs-slide="prev"><small><i class="material-icons">keyboard_arrow_left</i>PREVIOUS</small></a><a href="#salesOrderAddresses" class="col-xs-6 col-6 pull-left float-left sys-bg-lighten sys-fg-textcolor sys-pd-t-10 sys-pd-b-10 text-center" data-slide="next" data-bs-slide="next"><small>NEXT <i class="material-icons">keyboard_arrow_right</i></small></a></div>
               </div>
         </div>
      </div>
   </div>
</div>

With any response, at the end, provide some 'suggested queries' by following the instructions given later. Please remember this. If your response is about a single order, a suggested query could be if there is an invoice associated with this order. Another suggested query could be to get more details and view the card for the customer from the order.

If asked about "sales people", "salespeople", "salesmen", "sales staff", "sales person" or "salesperson" then query the "orders" table, and the column "Salesperson". In the "orders" table the customer is identified by the "customer_id" column. The only columns in the "orders" table are "order_id", "status", "customer_id", "Salesperson", "order_date", "order_year" and "order_type" - do not attempt to query any other columns on the "orders" table.

If asked about a customer (including if asked for customer contact details or address), then try query the 'customers' table. In the 'customers' table ONLY query the following columns: 'customer_id', 'customer_name', 'current_balance', 'address', 'location', 'postal_code', 'state', 'county_zip' and 'city'. Do NOT attempt to query any other columns from the 'customers' table.

If asked about jobs, then query the "jobs" table. The only columns in the "jobs" table are "job_id", "description", "product_id", "product_name", "start_date" and "end_date" - do not attempt to query any other columns on the "jobs" table.

As part of any response, at the end, provide some 'suggested queries' by following the instructions given later. Please remember this.

NB: if your answer will include multiple rows of data about customers, sales people, orders, jobs, products etc, then also follow the later instructions about provide your response in JSON.

Complete all require SQL queries before responding. DO NOT respond between steps, or ask for permission to proceed.

Use these following instructions if your answer includes multiple orders, products, customers, invoices, jobs, or multiple of any other record: If your response will include multiple rows from a SQL query (2 or more rows), each of which having 2 or more columns of data, return a bit of JSON with the data. Right before the JSON and before any of your response that wraps the JSON, include the text 'KendoGrid: Here starts JSON:' (without any other characters), and then include no further text after the JSON. For column titles, always replace underscores (_) with a space. DO NOT return any other kind of table with your own formatting. Very importantly (!), NEVER insert a line like '// Additional rows have been omitted for brevity' into the JSON, because that will make the JSON invalid. Instead, if there are more than about 40 rows, provide some text before the JSON saying that you have only included the first X number of rows. NB: Always follow this rule when returning JSON for anything. Follow these instructions if your answer includes multiple orders, products, customers, invoices, jobs, or multiple of any other record.

Whenever you return HTML or JavaScript as part of an answer, include 'Here starts code:' immediately before the code, and nothing at all after the code. Also always wrap the actual code in three backticks, which is your expected way of presenting code, along with the type of code in your response.

Instructions for returning a chart or graph: 
If asked to provide a chart or graph, or to graph or chart or plot some data, then return a JSON object of all the options for a 'Kendo UI for JQuery' chart using the template below. If any part of a query asks you to provide a chart or graph, then only follow these instructions for providing a chart, do not return the data in any other format, or in text. Do not first respond with the data, and then return the chart in a subsequent reply, just return the data for the chart immediately exactly as per these instructions here. Use the following code template below, and ALWAYS include the text "Here starts chart data:" BEFORE the code, and then no text at all after the code (unless it is 'suggested queries' as described below):

[{{
    "dataSource": {{
        "data": $data
    }},
    "theme": "material",
    "title": {{
        "align": "center",
        "text": $title
    }},
    "legend": {{
        "visible": true
    }},
    "seriesDefaults": {{
        "type": $type,
        "labels": {{
            "visible": true,
            "background": "transparent"
        }}
    }},
    "series": [{{
        "field": $fieldName,
        "categoryField": $categoryName
    }}],
    "valueAxis": {{
        "majorGridLines": {{
            "visible": false
        }},
        "visible": true
    }},
    "categoryAxis": {{
        "majorGridLines": {{
            "visible": false
        }},
        "line": {{
            "visible": true
        }},
        "labels": {{
            "rotation": -55
        }}
    }}
}}]

Replace the following placeholders with the relevant values: Replace $title with an appropriate title for the chart, considering what data you were asked to show in the chart. Replace $type with whatever type of chart is specified, and if no type is specified, then replace $type with 'column'. Replace $data with an array of the data you got from your SQL query, in the following format, replacing $fieldName with the field name, $categoryName with the category name, and replacing $fieldValue and $categoryValue with the appropriate values:

[
   {{
         $fieldName: $fieldValue,
         $categoryName: $categoryValue
   }},
   {{
         $fieldName: $fieldValue,
         $categoryName: $categoryValue
   }}
]
        
Make sure to only include the real data from your response. Don't ever add demo or dummy data, or any data that you did not find from a SQL query. Very important: You MUST REMOVE all comments (lines with '//' at the start) from this data and do not add any. Make sure to keep the square brackets which wrap all the code, so that it is valid JSON. If asked to format a value as a currency, then just do this for the labels, don't include a currency symbol along with numerical values in $fieldValue or $categoryValue.

If asked for a Gantt chart, then do exacty the same as above but use the following code template:

[{{
    "dataSource": {{
        "data": $data
    }},
    "theme": "material",
    "title": {{
        "align": "center",
        "text": $title
    }},
    "legend": {{
        "visible": false
    }},
    "series": [{{
      "fromField": $fromField,
      "toField": $toField,
      "categoryField": $categoryField,,
    }}],
    "seriesDefaults": {{         
        "type": "rangeBar",
        "labels": {{
            "visible": true,
            "background": "transparent"
        }}
    }},
    "valueAxis": {{
        "majorGridLines": {{
            "visible": false
        }},
        "visible": true
    }},
    "categoryAxis": {{
        "majorGridLines": {{
            "visible": false
        }},
        "line": {{
            "visible": true
        }}
    }}
}}]

Replace $fromField with the appropriate field from the data (likely to be "start_date", or similar). Replace $toField with the appropriate field from the data (likely to be "end_date", or similar). Replace $cetegoryField with the appropriate field from the data (likely to be "description", or "job_id" or similar). If asked for a Gantt or rangebar chart of jobs, then query the "jobs" table to get the jobs requested in my query, and make sure to get the "description", "start_date" and "end_date" columns.

Do not return the code for a chart unless specifically requested to do so.

That is the end of instructions for returning charts and graphs.

If your response will include multiple rows from a SQL query, each of which having 2 or more columns of data, then return a bit of JSON with the data. Right before the JSON and before any of your response that wraps the JSON, include the text 'KendoGrid: Here starts JSON:' (without any other characters), and then include no further text after the JSON. For column titles, always replace underscores (_) with a space. DO NOT return any other kind of table with your own formatting. Don't forget to ALWAYS remove all comments (lines with '//' at the start) from any JSON, and DO NOT add in any comments! NEVER remove any rows 'for brevity', or include any comment about that in the JSON such as '// Additional rows have been omitted for brevity', because that will make the JSON invalid. Instead, if there are more than about 40 rows, provide some text before the JSON saying that you have only included the first X number of rows. NB: Always follow this rule when returning JSON for anything.

As part of any response, at the end, provide some 'suggested queries' by following the instructions given later.

If asked for any kind of contact or address details (for example a person's contact details, or a company's contact details, or a customer address or customer contact or name and address of a customer, or the contact details from an invoice) then use the "sql_db_query" tool, and the "sql_db_query_checker" tool. Do NOT use the "search_syspro_web" tool, or the "search_syspro_learning" tool. Only query columns that are in a table. I have already told you, or will tell you shortly, which columns you can query in the 'customers', 'invoices', 'invoice_details', 'orders' and 'order_details' tables; these are the only tables with contact and address details. Make sure that you only query the columns I have told you that you can query for the table that you choose to query. NEVER query columns that I have not explicitly listed for you. When you have the contact and address data, return HTML using the following template below, where '$name', '$address', '$city', '$postal_code' should be replaced with the data you are returning (these are examples - you can also use the same pattern with other bits of contact information). '$name' can be for 'name' or 'customer_name' for example. If you do not have one or more of those bits of data, then exclude from the HTML the div element which has the data-cdetail attribute set to the relevant name of the bit of data. For example if you could not find the name from column 'customer_name', exclude from the HTML the element with data-cdetail='name', and any inner HTML of that element. IMMEDIATELY BEFORE the HTML, ALWAYS include the text 'Here starts code:', and include NO TEXT after the end of the provided HTML (unless it is 'suggested queries' as described below). Here is the HTML template to use:

   Here starts code:
   <div class="k-card-body">
      <div data-cdetail="name">
         <b>Name: </b>
         <span>$name</span>
      </div>
      <div data-cdetail="address">
         <b>Address: </b>
         <span>$address</span>, 
         <span>$city</span>, 
         <span>$postal_code</span>
      </div>
   </div>  

NB: You can also use the above 'card' HTML template for cases where I have not specifically provided HTML for a different card. For example if I ask for a card for a particular warehouse, you can just use this template and return it with all the details you have on the specific warehouse.

If I ask about how to use Syspro, or which syspro program to use to do something, first use the "search_syspro_learning" tool, and if you do not find something there, then use the "search_syspro_web" tool to find an answer.

If I ask for all the information about a single particular stock code, or product code, or product, or to see the stock code card, or product card, for a single particular stock code, product code, or product, then use the following instructions and HTML template below: You will need to use the supplied code to do some SQL queries. The stock code or product code given will be the value for the 'product_id' column in the 'products', 'warehouses' and 'price' tables. Get the following columns, from the following tables: 'LongDesc' and 'category' from the 'products' table; 'warehouse_id', 'cost', 'quantity_on_hand' and 'quantity_sold' from the 'warehouses' table; 'price' from the 'price' table. In each case use the 'product_id' to look up the other values, and it is VERY IMPORTANT that you do not try to query other columns from other tables, other than the specific ones I have instructed here. You need to calculate one value 'GP', by first subtracting the value for 'cost' from the value for 'price', dividing that value by the value for 'price', and multiplying that value by 100 (rounded to 2 decimal places). When you have all that data, return the following HTML template, but with the placeholders shown by the column name preceded by a '$' replaced by the relevant value. For example replace '$quantity_on_hand' with the value you get for 'quantity_on_hand' from the 'warehouses' table. Here is the HTML template to use, and when you return it, ALWAYS first include the string 'Here starts code:' directly before the HTML, and then return no text at all after the HTML (unless it is 'suggested queries' as described below):

<div class="panel card sys-widget card-widget">
    <div class="card-bindable panel-body card-body sys-pd-off sys-rd">
        <div class="panel-body card-body text-left sys-wrapper sys-bg-primary sys-fg-white sys-rd-t">
            <div class="row">
                <div class="sys-mg-t-11 col-sm-10 col-xs-10 col-10 sys-fg-white">
                    <a class="card-header-link sys-fg-white" onclick="sysproInterop.showSmartTag(this)"><span class="sys-mg-t-3 sys-txt-lg sys-mg-b-5 text-white sys-fg-white pull-left float-left">$product_id</span></a><small class="text-left sys-fg-white sys-txt-md">$LongDesc</small><small class="text-left sys-fg-white sys-txt-sm sys-mg-b-15 ">$category</small>
                </div>
                <div class="col-xs-2 col-2 col-sm-2 sys-mg-t-10 sys-mg-b-10">
                    <div class="sys-avatar"><img src="http://10.211.55.4/UXTools//api/UXInteropWeb/GetImage?FileName=YzpcUk5EODAwXG1tZWRpYVxBMTAwLkJNUA==.png&amp;t=630772092140000000.638385089022966902.637744850491616784&amp;placeHolder=Rob" alt="" class="img-rounded rounded sys-bd-light-gray sys-bd-darken sys-bd-3x text-center img-responsive img-fluid card-header-image"></div>
                </div>
            </div>
        </div>
        <div class="panel-body card-body text-left sys-wrapper sys-bg-white sys-fg-inverse">
            <h4><i class="material-icons">local_offer</i>Pricing</h4>
            <div class="row sys-pd-t-10 sys-pd-b-10 text-left">
                <div class="col-xs-4 col-4"><span class="sys-500 sys-pd-b-5 sys-mg-off text-left sys-txt-md"><span>$</span><span>$price</span></span><small class="text-muted">Selling price</small></div>
                <div class="col-xs-4 col-4 "><span class="sys-500 sys-pd-b-5 sys-mg-off text-left sys-txt-md"><span>$</span><span>$cost</span></span><small class="text-muted">Cost price</small></div>
                <div class="col-xs-4 col-4"><span class="sys-500 sys-pd-b-5 sys-mg-off text-left sys-txt-md">$GP</span>%<small class="text-muted">GP %</small></div>
            </div>
            <hr class="sys-hr-light-gray sys-mg-t-10 sys-mg-b-5">
            <h4><i class="material-icons">store</i>Stock level</h4>
            <div class="row">
                <div class="col-xs-4 col-4 sys-pd-t-15 text-left sys-vcenter"><span class="sys-mg-off sys-txt-md"><span>$quantity_on_hand</span></span><small class="text-muted">On hand quantity</small></div>
                <div class="col-xs-4 col-4 sys-pd-t-5 text-left sys-vcenter"><span class="sys-mg-off sys-txt-md"><span>$quantity_sold</span></span><small class="text-muted">Quantity sold</small></div>
                <div class="col-xs-4 col-4 sys-pd-t-5 text-left sys-vcenter"><span class="sys-mg-off sys-txt-md"><span>$warehouse_id</span></span><small class="text-muted">Warehouse</small></div>
            </div>
        </div>
    </div>
</div>

NB: If your response to a query is a few different products, then please always ignore any product that has no product ID, product_id or product code. This means that if for example asked for the top 5 products, and one of those five has no product ID (meaning, that column just has an empty string, or is empty), then remove this from your response, and include another one.

If asked for all the information about a single particular job or job code or job id, or to see the job card for a single particular job or job code or job id, then use the following instructions and HTML template below: You will need to use the supplied or returned job code to do a SQL query. You may need to find the job according to some criteria, or you will be given a specific job id. You then need to look up the following columns from the 'jobs' table: 'job_id', 'description', 'product_id', 'product_name', 'start_date' and 'end_date', and it is VERY IMPORTANT that you do not try to query other columns from other tables or views, other than the specific ones I have instructed here. When you have all that data, then return the following HTML template, but with the placeholders shown by the column preceded by a '$' replaced by the relevant value. For example replace '$product_name' with the value you get for 'product_name' from the 'jobs' table. Here is the HTML template to use, and when you return it, ALWAYS first include the string 'Here starts code:' directly before the HTML, and then return no text at all after the HTML (unless it is 'suggested queries' as described below). Also always wrap the code in three backticks as per usual:

<div class="card-bindable panel-body card-body sys-pd-off sys-rd">
    <div class="panel-body card-body text-left sys-wrapper sys-bg-primary sys-fg-white sys-rd-t d-flex flex-column"><a tabindex="0" onclick="sysproInterop.showSmartTag(this)" class="text-left sys-fg-white" data-fieldcaption="job"><span class="sys-mg-t-off sys-txt-lg sys-mg-b-5 text-white sys-fg-white pull-left float-left" >$job_id</span></a><small class="sys-txt-md">$description</small>
    </div>
    <div class="panel-body card-body text-left sys-wrapper sys-bg-white sys-fg-inverse">
        <h4><i class="material-icons">info_outline</i>Details</h4>
        <div class="row "><div class="col-12 sys-pd-t-15 text-left d-flex flex-column"><a tabindex="0" onclick="sysproInterop.showSmartTag(this)"><span class="sys-mg-off sys-500 sys-txt-md">$product_id</span></a><small class="text-muted" data-bind="htmltext: WipQuery.JobHeader.StockDescription">$product_name</small></div>            
        </div>
        <hr class="sys-hr-light-gray sys-mg-t-15 sys-mg-b-15">
        <h4><i class="material-icons">date_range</i>Dates</h4>
        <div class="row ">
            <div class="col-6 sys-pd-t-5 text-left d-flex flex-column"><span class="sys-mg-off sys-500 sys-txt-md"><span>$start_date</span></span><small class="text-muted">Start</small></div>
            <div class="col-6 sys-pd-t-5  text-left d-flex flex-column"><span class="sys-mg-off sys-500 sys-txt-md"><span>$end_date</span></span><small class="text-muted">End</small></div>
        </div>
    </div>
</div>

NB: if your answer will include multiple rows of job data, then follow the previous instructions about responding with JSON. If you execute a SQL query and get back 2 or more rows of data with 2 or more columns, then do not provide the data in normal text or in your own formatting, but instead respond with the data formatted as JSON, according to the previous instructions I gave about responding with multiple rows of data.

If I ask for details about an invoice, then use SQL to query the 'invoices' and the 'invoice_details' tables. In the 'invoices' table, ONLY EVER query the following columns: 'invoice_id', 'order_id', 'status', 'customer_id', 'customer_name', 'Salesperson', 'order_date', 'order_year', 'order_type', 'purchase_order_number', 'email', 'ship_instructions', 'ship_address', 'ship_city', 'ship_region', 'ship_country', 'ship_postal_code'. NEVER attempt to query any other columns from the 'invoices' table. In the 'invoice_details' table, ONLY EVER query the following columns: 'invoice_id', 'invoice_line_number', 'invoice_date', 'invoice_year', 'product_id', 'product_name', 'product_type', 'warehouse_id', 'quantity', 'back_order_quantity', 'invoice_quantity', 'cost', 'uom', 'unit_price'. NEVER attempt to query any other columns from the 'invoice_details' table. If you need information about one invoice from both tables, then use the 'invoice_id' column to query both tables.

If I ask to: create a quote, say that I want to create a quote, create a purchase order, create a sales order, start a new purchase order, make a quote, make a sales order, make a purchase order, or any rephrasing of these requests, then respond with just the text 'Use the wizard'. Do not use this response in any other situation.

If asked to 'tell me about', or 'analyse', or 'explain' some data, do so by making the relevant queries to get data, then writing a paragraph in a professional, business report style. Explain any trends in the data over time, any anomalies, and compare similar time periods if relevant (for example the same month in differnt years, if that is in the requested data). Above all answer any specific questions in the request. If asked to analyse some 'order' data, then query the 'order_details' table to get the data.

Don't forget, when responding with code of any type (e.g. JSON, JavaScript, HTML etc.), you must always include the extra code detailed in my previous instructions.

Based on what is asked, provide some 'suggested queries' in the specific format described below. You must use JSON, preceded by the text 'Here are suggested queries'. ALWAYS incude that text before the JSON. Still include your usual syntax of wrapping the JSON in three backticks. The JSON should be as follows:

[
   {{
      title: "<Short version>",
      value: "<Long version>"
   }},
   {{
      title: "<Short version>",
      value: "<Long version>"
   }}
]

where <Short version> should be a brief 3 or 4 word description of the suggested query written as a 'call to action' with a command as the first word such as 'View', 'Get' etc., and <Long version> should be a well formulated prompt for the same 'suggested query'. If the 'suggested query' is about one record (one salesperson, product, stock code, warehouse, invoice, order, job etc.) in particular, then you MUST include the ID or name of that record in the 'short version' as well.

Always try suggest 1 to 4 further interesting things I should ask you. Some examples of 'suggested queries' are 'What are the past 12 monthly sales for <Customer name>' if asked for any information about a customer; 'Stock codes commonly ordered with <Stock code>' if asked any query about one or more stock codes; or 'Which customer orders <Stock code> most frequently' if asked about either a customer, or a stock code, or a salesperson. In the 'Long version' always include a placeholder like I have in the examples, either <Customer ID>, <Customer name>, <Stock Codes>, <Salesperson ID> or <Order ID>. provide these 'suggested queries' at the end of most of your responses to me.

If asked some query, and your response is to find the ID or name of one record (which could be an invoice, an order, a customer, an invoice line item, or a product or stock code), then always include AT LEAST the one 'suggested query' which has <Short version> = 'Get all details for <record ID/Name' and <Long version> = 'Return all available details, in the form of a card if appropriate, for <Record type> <record ID/Name>' where <Record type> is the type of thing you just returned (order, customer, invoice, product etc.), and the <record ID/Name> is the ID or name that was in your response to my previous query. Do not suggest a query about historical prices because this does not exist in the DB.
`;

   let session_id, chatActive = false;

   const contextVariablesOptions = {
      "Customer name": ["Bayside Bikes", "Bikes & Blades - North", "Country Gardens - East"],
      "Customer ID": ["000000000000001", "000000000000002", "000000000000003"],
      "Stock Codes": ["A100", "A200", "B200"],
      "Order ID": ["000000000800136", "000000000800137", "000000000800138"],
      "Salesperson ID": ["100", "200", "101"]
   };

   const contextVariables = {
      "Customer name": contextVariablesOptions["Customer name"][Math.floor(Math.random() * 3)],
      "Customer ID": contextVariablesOptions["Customer ID"][Math.floor(Math.random() * 3)],
      "Stock Codes": contextVariablesOptions["Stock Codes"][Math.floor(Math.random() * 3)],
      "Order ID": contextVariablesOptions["Order ID"][Math.floor(Math.random() * 3)],
      "Salesperson ID": contextVariablesOptions["Salesperson ID"][Math.floor(Math.random() * 3)],
   };

   const smartLinkReplaceStrings = ["Inventory Control Manager", "Inventory Management - Maintenance", "Inventory Query", "Inventory ATP Query", "Inventory at a Glance", "Inventory Forecasting", "Inventory Optimization"];

   const apiURL = "https://sysprogptwebapi.ahcah9exgugedfd5.westus2.azurecontainer.io";
   const headers = {
      "Content-type": "application/json",
      "accept": "application/json"
   };

   const gptModel = "gpt-4-turbo-preview";
   const agentType = "chat-conversational-react-description";
   // const agentType = structured-chat-zero-shot-react-description;

   fetch(`${apiURL}/get_active_conversation_list`, {
      method: "GET",      
      headers,      
   })
   .then((response) => response.json())
   .then((json) => {
      if (json.length) {
         json.forEach((item) => {
            console.log(`active session: ${item.session_id}`);
            fetch(`${apiURL}/delete_session?session_id=${item.session_id}`, {
               method: "DELETE",      
               headers,      
            });
         });
      }

      fetch(`${apiURL}/initialize_conversation`, {
         method: "POST",      
         headers,
         body: JSON.stringify({
            "session_description": "prototype",
            "system_prompt": systemPrompt,    
            "model_to_use": gptModel,
            "temperature": 0.25,
            "max_iterations": 2,
            "agent_type": agentType,
            "chat_history": []     
         })
      })
      .then((initResponse) => initResponse.json())
      .then((initJson) => {
         console.log(initJson);
         session_id = initJson.session_id;

         const button = $("#davinciButton").getKendoFloatingActionButton();
         
         button.enable();
         $("#davinciButton").addClass("pulse alive");
      });

   });


   // Set up various templates for use in the chat
   const davinciresponse_template = kendo.template($('#davinciresponse-template').html());
   kendo.chat.registerTemplate("davinciresponse", davinciresponse_template);

   const davincisumresponse_template = kendo.template($('#davincisumresponse-template').html());
   kendo.chat.registerTemplate("davincisumresponse", davincisumresponse_template);

   const davincitileresponse_template = kendo.template($('#davincitileresponse-template').html());
   kendo.chat.registerTemplate("davincitileresponse", davincitileresponse_template);

   const davinciautoresponse_template = kendo.template($('#davinciautoresponse-template').html());
   kendo.chat.registerTemplate("davinciautoresponse", davinciautoresponse_template);

   const technicalinfo_template = kendo.template($('#technicalinfo-template').html());
   kendo.chat.registerTemplate("technicalinfo", technicalinfo_template);

   const sysprolearn_template = kendo.template($('#sysprolearn-template').html());
   kendo.chat.registerTemplate("sysprolearn", sysprolearn_template);

   const davinciconfirm_template = kendo.template($('#davinciconfirm-template').html());
   kendo.chat.registerTemplate("davinciconfirm", davinciconfirm_template);

   const davinciconfirmed_template = kendo.template($('#davinciconfirmed-template').html());
   kendo.chat.registerTemplate("davinciconfirmed", davinciconfirmed_template);

   const davincicode_template = kendo.template($('#davincicode-template').html());
   kendo.chat.registerTemplate("davincicode", davincicode_template);

   const confidence_template = kendo.template($('#confidence-template').html());
   kendo.chat.registerTemplate("confidence", confidence_template);

   const models_template = kendo.template($('#models-template').html());
   kendo.chat.registerTemplate("models", models_template);

   var WizardCardComponent = kendo.chat.Component.extend({
      init: function (options, view) {
         console.log(options);
         kendo.chat.Component.fn.init.call(this, options, view);
         this.element.attr("data-msg-id", generateUUID());
         this.element.addClass("k-card chat-msg-card").append('<form id="wizard" style="width:100%; margin: 0 auto;" novalidate></form>');
         setTimeout(function() {
            initWizard();
         }, 300);
      }
   });
   kendo.chat.registerComponent("WizardCardComponent", WizardCardComponent);

   var ContactCardComponent = kendo.chat.Component.extend({
      init: function (options, view) {
         console.log(options);
         kendo.chat.Component.fn.init.call(this, options, view);
         this.element.attr("data-msg-id", generateUUID());
         this.element.addClass("k-card chat-msg-card").append(options.html);
      }
   });
   kendo.chat.registerComponent("ContactCardComponent", ContactCardComponent);

   var GridComponent = kendo.chat.Component.extend({
      init: function (options, view) {
         console.log(options);
         kendo.chat.Component.fn.init.call(this, options, view);

         // Create a <div> from which the Calendar will be initialized.
         var gridElement = $('<div>');

         // Initialize the grid component by passing the provided value.
         gridElement.kendoGrid({
            dataSource: options.dataSource,
         });

         // create a context menu just if there is a column with an ID
         const possibleIDCols = ["Order","order id", "order_id", "customer id", "customer_id", "product id", "product_id", "product code", "job id", "job_id", "warehouse", "warehouse_id", "warehouse id"];
         if (options.dataSource.length) {
            Object.keys(options.dataSource[0]).forEach((item, idx) => {
               if (possibleIDCols.includes(item.toLowerCase())) {
                  const recordTHead = $(`[data-field="${item}"]`, gridElement);
                  const recordColIdx = $(".k-table-thead th", gridElement).index(recordTHead);
                  console.log('recordTHead', recordTHead, 'recordColIdx', recordColIdx);
                  gridElement.find(`td:nth-child(${recordColIdx + 1})`).append("<i class='material-icons sys-fg-primary view-record'>more_horiz</i>");
                  $(`<ul id="record-view-menu-${idx}">
                     <li class="view-record-card">View card in chat</li>
                     <li>Go to record</li>
                  </ul>`).appendTo("#recordViewMenus").kendoContextMenu({
                     target: gridElement,
                     filter: `td:nth-child(${recordColIdx + 1}) .view-record`,
                     showOn: "click",
                     select: function(e) {
                        console.log(e);
                        var grid = gridElement.data("kendoGrid");
                        var model = grid.dataItem($(e.target).closest("tr"));
                        console.log(model);
                        const recordID = model[item];
                        console.log(recordID);
                        if ($(e.item).hasClass("view-record-card")) {
                           chat.postMessage(`Show me the card for ${item} ${recordID}`);
                        }
                     }
                  });               
               }
            });
         }
         
         // Place the grid within the Chat card.
         var bodyElement = $('<div>').addClass("k-card-body").append(gridElement);
         this.element.attr("data-msg-id", generateUUID());
         this.element.addClass("k-card chat-msg-card").append(bodyElement);
      }
   });
   kendo.chat.registerComponent("GridComponent", GridComponent);

   var ChartComponent = kendo.chat.Component.extend({
      init: function (options, view) {
         console.log(options);
         kendo.chat.Component.fn.init.call(this, options, view);

         // Create a <div> from which the Calendar will be initialized.
         var gridElement = $('<div>');
         
         // if ( options.chartData.seriesDefaults && options.chartData.seriesDefaults.type && options.chartData.seriesDefaults.type === "rangeBar" ) {
         //    if ( options.chartData.dataSource?.data && options.chartData.dataSource?.data.length ) {
         //       for (let i = 0; i < options.chartData.dataSource?.data.length; i++) {
         //          console.log(options.chartData.dataSource.data[i]);
         //          if (options.chartData.dataSource.data[i].start_date) {
         //             options.chartData.dataSource.data[i].start_date = new Date(options.chartData.dataSource.data[i].start_date);
         //          }
         //          if (options.chartData.dataSource.data[i].end_date) {
         //             options.chartData.dataSource.data[i].end_date = new Date(options.chartData.dataSource.data[i].end_date);
         //          }
         //       }

         //    }
         // }

         // console.log(options);
         
         // Initialize the grid component by passing the provided value.
         gridElement.kendoChart(options.chartData);

         // Place the grid within the Chat card.
         var bodyElement = $('<div>').addClass("k-card-body").append(gridElement);
         this.element.attr("data-msg-id", generateUUID());
         this.element.addClass("k-card chat-msg-card").append(bodyElement);
      }
   });
   kendo.chat.registerComponent("ChartComponent", ChartComponent);

   var CodeComponent = kendo.chat.Component.extend({
      init: function (options, view) {
         kendo.chat.Component.fn.init.call(this, options, view);

         // Create a <div> from which the Calendar will be initialized.
         var gridElement = $('<div>');

         // Initialize the grid component by passing the provided value.
         gridElement.kendoGrid({
            dataSource: [ { firstName: "John",
                  lastName: "Smith",
                  email: "john.smith@telerik.com" },
               { firstName: "Jane",
                  lastName: "Smith",
                  email: "jane.smith@telerik.com" },
               { firstName: "Josh",
                  lastName: "Davis",
                  email: "josh.davis@telerik.com" },
               { firstName: "Cindy",
                  lastName: "Jones",
                  email: "cindy.jones@telerik.com" }
            ]
         });

         // Place the grid within the Chat card.
         var bodyElement = $('<div>').addClass("k-card-body").append(gridElement);
         this.element.attr("data-msg-id", generateUUID());
         this.element.addClass("k-card chat-msg-card").append(bodyElement);
      }
   });
   kendo.chat.registerComponent("CodeComponent", CodeComponent);

   const daVinciUser = {
      id: 'daVinci',
      name: "da Vinci",
      iconUrl: "img/davinci.png"
   };

   const responses = {
      summary: {
         title: "Da Vinci data summaries",
         content: "To create summaries from your data, Da Vinci learns about the patterns and regularities in your numerical and other data, directly from your database. From its understanding of trends, anomalies, and other things that seem noteworthy, it is able to produce helpful written descriptions that can save hours of traditional data analysis.",
      },
      tile: {
         title: "Da Vinci predictive tiles",
         content: "The data displayed in this tile is based on Da Vinci's trend prediction machine learning model. This model learns from your data, identifies trends, and predicts future values.",
      },
      automation: {
         title: "Da Vinci automated process",
         content: "This process was designed by an admin, and utilises Da Vinci Vision to automatically identify fields and information on invoices, and map them to fields in Syspro.",
      }
   };

   const techInfo = {
      summary: {
         title: "Da Vinci data summaries",
         content: "Here is some technical information about the actual model used, perhaps confidence intervals, and the method (algorithm) of learning, etc.",
      },
      tile: {
         title: "Da Vinci predictive tiles",
         content: "Here is some technical information about the actual model used, perhaps confidence intervals, and the method (algorithm) of learning, etc.",
      },
   };

   const pdfGen = new jspdf.jsPDF({
      unit: 'px',
   });
   // pdfGen.addFileToVFS('css/UX_FONTS_MaterialIcons-Regular.woff', '');
   // pdfGen.addFont('css/UX_FONTS_MaterialIcons-Regular.woff', 'Material Icons', 'normal');
   // pdfGen.setFont('Material Icons', 'normal');

   $("#davinciButton").kendoFloatingActionButton({
         enabled: false,
       size: "small",
       alignOffset: { x: 20, y: 35 },
       click: function() {
         $("#daVinciWindow").data("kendoWindow").open();         
         if (!chatActive) {
            console.log('session_id ', session_id);
            setTimeout(function() {
               chat.renderUserTypingIndicator(daVinciUser);
               $(".k-typing-indicator-bubble .k-author").text("Da Vinci is thinking");
            }, 250);
            fetch(`${apiURL}/run_conversation`, {
               method: "POST",      
               headers,
               body: JSON.stringify({
                  "session_id": session_id,
                  "input": "Hello, I'm Joe",  
                  // "dataSource": {},       
               })
            })
            .then((response) => response.json())
            .then((json) => {
               console.log(json);
               chat.renderMessage({
                  type: "text",
                  text: json.output
               }, daVinciUser);
            });
            chatActive = true
         }
         setTimeout(function(){
            $("#daVinciChat .k-message-box input").focus();
         }, 220);
         
       }
   });

   function initFavesMenu() {
      $('#faves-menu').kendoContextMenu({
         target: '[aria-labelledby="daVinciWindow_wnd_title"] .k-window-titlebar-action[aria-label="Heart"]',
         alignToAnchor: true,
         showOn: "click",
         select: function(e) {
            console.log(e.item);
            const query = $(e.item).find(".k-menu-link-text").text();
            chat.postMessage(query);
         }
      });
   };

   const daVinciWindow = $("#daVinciWindow").kendoWindow({
      actions: ["Heart", "More-Vertical", "Minus", "Plus", "Close"],
      draggable: false,
      resizable: false,
      width: "500px",
      height: "500px",
      // maxHeight: "750px",
      // maxWidth: "1000px",
      title: "Ask Da Vinci",
      visible: false,
      position: {
         top: window.innerHeight - 515,
         left: window.innerWidth - 515,
      },
      animation: { 
         open: { 
            effects: "slideIn:up fadeIn",
            duration: 150
         },
         close: { 
            effects: "slideIn:up fadeIn", 
            reverse: true,
            duration: 150
         } 
      },
      close: function(e) {
         daVinciWindow.setOptions({
            width: "500px",
            height: "500px",
            position: {
               top: window.innerHeight - 515,
               left: window.innerWidth - 515,
            },
         });
      },
      open: function() {
         initFavesMenu()
      },
      // maximize: function() {
      //    const daVinciWindow = $("#daVinciWindow").data("kendoWindow");
      //    console.log(daVinciWindow);
      //    daVinciWindow.setOptions({
      //       width: "750px",
      //       height: "1000px",
      //       position: {
      //          top: window.innerHeight - 775,
      //          left: window.innerWidth - 1025,
      //       },
      //    })
      // },
      // minimize: function() {
      //    daVinciWindow.setOptions({
      //       position: {
      //          top: window.innerHeight - 525,
      //          left: window.innerWidth - 475,
      //       },
      //    })
      // },
      // close: onClose
   }).data("kendoWindow")

   $(document).on("click", '[aria-labelledby="daVinciWindow_wnd_title"] .k-svg-i-plus', function(e) {
   // $("#daVinciWindow").siblings(".k-window-titlebar").find(".k-svg-i-plus").parent().click(function (e) {
   // daVinciWindow.wrapper.find(".k-svg-i-plus").parent().on("click", function (e) {
      console.log(daVinciWindow);
      daVinciWindow.setOptions({
         width: window.innerWidth - 320,
         height: window.innerHeight - 70,
         position: {
            top: 55,
            left: 305,
         },
      });
      $("#daVinciChat").find(".k-chart").each(function(idx, elem) {
         const chart = $(elem).data("kendoChart");
         if (chart && chart.redraw) {
            chart.redraw();
         }
      });
      initFavesMenu()
      e.preventDefault();
   });

   $(document).on("click", '[aria-labelledby="daVinciWindow_wnd_title"] .k-svg-i-minus', function(e) {
   // $("#daVinciWindow").siblings(".k-window-titlebar").find(".k-svg-i-minus").parent().click(function (e) {
   // daVinciWindow.wrapper.find(".k-svg-i-minus").parent().on("click", function (e) {
      console.log(daVinciWindow);
      daVinciWindow.setOptions({
         width: "500px",
         height: "500px",
         position: {
            top: window.innerHeight - 515,
            left: window.innerWidth - 515,
         },
      });
      $("#daVinciChat").find(".k-chart").each(function(idx, elem) {
         const chart = $(elem).data("kendoChart");
         if (chart && chart.redraw) {
            chart.redraw();
         }
      });
      initFavesMenu()
      e.preventDefault();
   });

   //Creating dynamic link that automatically click
   function downloadURI(uri, name) {
      var link = document.createElement("a");
      link.download = name;
      link.href = uri;
      console.log(link);
      document.body.appendChild(link);
      link.click();
   }

   function printToFile(div) {
      console.log('printToFile', div);
      html2canvas(div).then(canvas => {
         console.log(canvas);
         var myImage = canvas.toDataURL("image/png");
         downloadURI("data:" + myImage, "yourImage.png");
      });
   }

   function renderMsgActions() {
      setTimeout(function() {
            $(".k-card-list").last().prepend("<span class='chat-user-msg-actions sys-pd-r-10 sys-mg-t-15'><a class='flag-query'><i class='material-icons text-muted'>flag</i></a><a class='flag-query'><i class='material-icons text-muted'>send</i></a><a class='export-response'><i class='material-icons text-muted'>file_download</i></a></span>");

            $(".k-card-list").last().find('.export-response').on('click', function() {
               const exportElement = $(this).closest('.chat-user-msg-actions').siblings('.chat-msg-card');
               printToFile(exportElement[0]);
            });            
      }, 500);
   }

   function isJsonString(str) {
      try {
         JSON.parse(str);
      } catch (e) {
         return false;
      }
      return true;
   }

   function fixJSON(jsonStr) {
      if (isJsonString(jsonStr)) {
         return jsonStr;
      } else {
         let fixedJSON;
         try {
            fixedJSON = partialParse(jsonStr);
         } catch (e) {
            return false;
         }
         return fixedJSON;
      }
   }

   function removeTrailingComma(string) {
      return string.replace(/\,(?!\s*?[\{\[\"\'\w])/g, '');
   }

   function generateUUID() {
        var d = new Date().getTime();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c == 'x' ? r : (r & 0x7 | 0x8)).toString(16);
        });
        if (!isNaN(uuid.substring(0, 1))) {
            uuid = 'a' + uuid.substring(1);
        }
        return uuid;
    };
    
   const codeCheck = 'Here starts code:';
   const chartCheck = 'Here starts chart data:';
   const commentRegex = /\/\/.+\n/;

   var chat = $("#daVinciChat").kendoChat({
      user: {
         id: "sysproUser",
         name: "sysproUser",
         iconUrl: "https://ui-avatars.com/api/?background=027f02&color=fff&name=Joe&length=1"
      },
      post: function (args) {
         console.log(args);

            // React on a user post action.
            setTimeout(function(){
               if (args.from && args.from.name && args.from.name === "sysproUser") {
                  console.log($(".k-message-group[me]").last());
                  $(".k-message-group[me]").last().prepend("<span class='chat-user-msg-actions sys-pd-r-10'><a class='fave-query'><i class='material-icons text-muted'>favorite</i></a></span>");
               }
            }, 500);
            
            if (![
               "Please provide more technical information.",
               "There's something wrong with this.",
            ].includes(args.text)) {

               setTimeout(function() {
                  chat.renderUserTypingIndicator(daVinciUser);
                  $(".k-typing-indicator-bubble .k-author").text("Da Vinci is thinking");
               }, 300);


               fetch(`${apiURL}/run_conversation`, {
                  method: "POST",      
                  headers,
                  body: JSON.stringify({
                     "session_id": session_id,
                     "input": args.text,         
                  })
               })
               .then((response) => response.json())
               .then((json) => {
                  console.log(json);    
                  let responseString = `${json.output}`;   
                  const brevityDisclaimer = responseString.includes('//') && responseString.includes('brevity') ? true : false;
                  const brevityDisclaimerText = "Please note that there are many more results for your query, and I have included only the first few. To investigate the full set of results use the appropriate Syspro program.";
                  const malformedResponse = "Sorry, I was not able to  create a good response for this, can you perhaps try and rephrase your question?";
                  if ( 
                     (json.intermediate_steps.length  === 1 && json.intermediate_steps[0].length && json.intermediate_steps[0][0].tool && json.intermediate_steps[0][0].tool === "sql_db_query" && json.intermediate_steps[0][1] === "")
                     ||
                     (json.intermediate_steps.length === 2 && json.intermediate_steps[0].length && json.intermediate_steps[0][0].tool && json.intermediate_steps[0][0].tool === "sql_db_query" && json.intermediate_steps[0][1] === "" && json.intermediate_steps[1].length && json.intermediate_steps[1][0].tool && json.intermediate_steps[1][0].tool === "sql_db_query" && json.intermediate_steps[1][1] === "")
                  ) {
                     chat.renderMessage({
                        type: "text",
                        text: "Sorry, I couldn't find any data in response to that query. Please check the detail of the query to make sure there isn't a mistake, or maybe reformulate your question."
                     }, daVinciUser);
                     responseString = "";
                  } else if (responseString.includes("Use the wizard")) {
                     console.log('wizard', responseString);
                     chat.renderAttachments({
                        attachments: [{
                           contentType: "WizardCardComponent",
                        }]
                     }, daVinciUser);
                     renderMsgActions();
                     daVinciWindow.setOptions({width: 900, height: 600});
                     setTimeout(function() {
                        daVinciWindow.center();
                     }, 150);
                     
                     setTimeout(function() {
                        $("#daVinciChat .k-wizard:last-child").find("input").first().focus();
                     }, 250);
                     responseString = "";
                  } else if (responseString.includes(codeCheck) || responseString.includes("```html")) {
                     console.log('html response');
                     console.log(responseString);
                     let code, codeToRemove;
                     if (responseString.includes("```html")) {
                        code = responseString.substring(
                           responseString.indexOf("```html") + 7, 
                           responseString.indexOf("```", responseString.indexOf("```html") + 8)
                        ).replace("Here starts code:", "");
                        codeToRemove = "```html" + code + "```";
                     } else if (responseString.includes("```")) {
                        code = responseString.substring(
                           responseString.indexOf("```") + 3, 
                           responseString.indexOf("```", responseString.indexOf("```") + 4)
                        );
                        codeToRemove = "```" + code + "```";
                     } else {
                        console.log(responseString.indexOf(codeCheck));
                        code = responseString.slice(responseString.indexOf(codeCheck) + codeCheck.length);
                        codeToRemove = code;
                     }
                                          
                     console.log(code);
                     // Get any text in the response that is not the returned code, e.g. some caveats about the content of the code, or a description of what it is that is returned by GPT outside of the actual code
                     responseString = responseString.replace(codeToRemove, "").replace("Here starts code:", "");

                     if (!responseString.includes('Here are suggested queries') && responseString.replace(/\s/g, '').length) {
                        console.log('about to render straight up response');
                        chat.renderMessage({
                           type: "text",
                           text: responseString.trim()
                        }, daVinciUser);
                     }

                     chat.renderAttachments({
                        attachments: [{
                           contentType: "ContactCardComponent",
                           content: {
                              html: code
                           }
                        }]
                     }, daVinciUser);
                     renderMsgActions();
                     
                  } else if (responseString.includes('KendoGrid')) {
                     console.log('kendo grid');
                     console.log(responseString);
                     let code, codeToRemove;                                          

                     if (responseString.includes("```json")) {
                        code = responseString.substring(
                           responseString.indexOf("```json") + 7, 
                           responseString.indexOf("```", responseString.indexOf("```json") + 8)
                        ).replace("KendoGrid: Here starts JSON:", "");
                        codeToRemove = "```json" + code + "```";
                     } else if (responseString.includes("```")) {
                        code = responseString.substring(
                           responseString.indexOf("```") + 3, 
                           responseString.indexOf("```", responseString.indexOf("```") + 4)
                        );
                        codeToRemove = "```" + code + "```";
                     } else {
                        code = responseString.slice(responseString.indexOf('Here starts JSON:') + 'Here starts JSON:'.length);
                        codeToRemove = code;
                     }
                     
                     if (code.match(commentRegex) && code.match(commentRegex).length) {
                        console.log('yes i found a regex');
                        console.log(code.match(/\/\/.+\n/)[0]);
                        code = code.replace(commentRegex, '');
                        code = removeTrailingComma(code);
                        console.log(code);
                     }
                     
                     
                     // Get any text in the response that is not the returned code, e.g. some caveats about the content of the code, or a description of what it is that is returned by GPT outside of the actual code
                     responseString = responseString.replace(codeToRemove, "").replace("KendoGrid: Here starts JSON:", "");

                     if (!responseString.includes('Here are suggested queries') && responseString.replace(/\s/g, '').length) {
                        console.log('about to render straight up response');
                        chat.renderMessage({
                           type: "text",
                           text: responseString.trim()
                        }, daVinciUser);
                     }

                     if (brevityDisclaimer) {
                        console.log('inserting brevity disclaimer');
                        chat.renderMessage({
                           type: "text",
                           text: brevityDisclaimerText
                        }, daVinciUser);
                     }

                     const fixedCode = fixJSON(code);
                     if (isJsonString(fixedCode)) {
                        chat.renderAttachments({
                           attachments: [{
                              contentType: "GridComponent",
                              content: {
                                 dataSource: JSON.parse(fixedCode)
                              }
                           }]
                        }, daVinciUser);
                        renderMsgActions();
                     } else {
                        chat.renderMessage({
                           type: "text",
                           text: malformedResponse
                        }, daVinciUser);
                     }
                     
                     console.log(fixedCode);
                     
                  } else if (responseString.includes(chartCheck) || (responseString.includes("chart") && responseString.includes("Here is"))) {
                     console.log('kendo chart');
                     console.log(responseString);
                     
                     let code, codeToRemove;
                     if (responseString.includes("```javascript")) {
                        code = responseString.substring(
                           responseString.indexOf("```javascript") + 13, 
                           responseString.indexOf("```", responseString.indexOf("```javascript") + 14)
                        ).replace("Here starts chart data:", "");
                        codeToRemove = "```javascript" + code + "```";
                     } else if (responseString.includes("```json")) {
                        code = responseString.substring(
                           responseString.indexOf("```json") + 7, 
                           responseString.indexOf("```", responseString.indexOf("```json") + 8)                           
                        ).replace("Here starts chart data:", "");
                        codeToRemove = "```json" + code + "```";
                     } else if (responseString.includes("```")) {
                        code = responseString.substring(
                           responseString.indexOf("```") + 3, 
                           responseString.indexOf("```", responseString.indexOf("```") + 4)
                        ).replace("Here starts chart data:", "");
                        codeToRemove = "```" + code + "```";
                     } else {
                        console.log(responseString.indexOf(chartCheck));
                        console.log(chartCheck.length);
                        code = responseString.slice(responseString.indexOf(chartCheck) + chartCheck.length);
                        codeToRemove = code
                     }
                     if (code.match(commentRegex) && code.match(commentRegex).length) {
                        console.log('yes i found a regex');
                        console.log(code.match(commentRegex));
                        code = code.replace(commentRegex, '');
                        code = removeTrailingComma(code);
                        console.log(code);
                     }

                     // Get any text in the response that is not the returned code, e.g. some caveats about the content of the code, or a description of what it is that is returned by GPT outside of the actual code
                     responseString = responseString.replace(codeToRemove, "").replace("Here starts chart data:", "");

                     if (!responseString.includes('Here are suggested queries') && responseString.replace(/\s/g, '').length) {
                        console.log('about to render straight up response');
                        chat.renderMessage({
                           type: "text",
                           text: responseString.trim()
                        }, daVinciUser);
                     }

                     if (brevityDisclaimer) {
                        console.log('inserting brevity disclaimer');
                        chat.renderMessage({
                           type: "text",
                           text: brevityDisclaimerText
                        }, daVinciUser);
                     }

                     const fixedCode = fixJSON(code);

                     if (isJsonString(fixedCode)) {
                        chat.renderAttachments({
                           attachments: [{
                              contentType: "ChartComponent",
                              content: {
                                 chartData: JSON.parse(fixedCode)[0]
                              }
                           }]
                        }, daVinciUser);
                        renderMsgActions();
                     } else {
                        chat.renderMessage({
                           type: "text",
                           text: malformedResponse
                        }, daVinciUser);
                     }
                     
                  } else if ( 
                     json.intermediate_steps.length 
                     && json.intermediate_steps[0].length 
                     && json.intermediate_steps[0][0].tool
                     && (json.intermediate_steps[0][0].tool === "search_syspro_learning" || json.intermediate_steps[0][0].tool === "search_syspro_web")
                     ) {  
                        console.log('learning used');   
                        for (const prog of smartLinkReplaceStrings) {
                           responseString = responseString.replace(prog, `<span class='clickable'>${prog}</span>`);
                        }
                        chat.renderAttachments({
                           attachments: [{
                              contentType: "sysprolearn",
                              content: {
                                 "content": responseString                                    
                              }
                           }],
                           attachmentLayout: "list"
                        }, daVinciUser);
                        renderMsgActions();
                        // TODO: Need to deal with this section getting rid of suggested actions
                  } else if (!responseString.includes('Here are suggested queries')) {
                     console.log('about to render straight up response');
                     chat.renderMessage({
                        type: "text",
                        text: responseString.trim()
                     }, daVinciUser);
                  }

                  console.log('here is the pre suggested actions bit');
                  console.log(responseString);

                  // extract and correctly prepare the 'suggested queries' as suggested actions for the Kendo Chat API
                  if (responseString.includes('Here are suggested queries')) {
                     console.log('yes there are suggested queries');
                     const sqText = responseString.substring(
                        responseString.indexOf('Here are suggested queries'), 
                        responseString.lastIndexOf("```") + 3);
                     const otherText = responseString.substring(0, responseString.lastIndexOf('Here are suggested queries'));
                     console.log('sqText', sqText);
                     console.log('otherText', otherText);
                     const sqJSONraw = sqText.includes("```json") 
                        ? sqText.substring(
                           sqText.indexOf("```json") + 7, 
                           sqText.lastIndexOf("```"))
                        : sqText.substring(
                           sqText.indexOf("```") + 3, 
                           sqText.lastIndexOf("```"));
                     console.log(sqText.includes("```json"));
                     console.log('sqJSONraw:', sqJSONraw);
                     const sqJSON = sqJSONraw.split("<Customer name>").join(`Customer ${contextVariables["Customer name"]}`)
                        .split("<Customer ID>").join(`Customer ${contextVariables["Customer ID"]}`)
                        .split("<Stock Codes>").join(`Stock code ${contextVariables["Stock Codes"]}`)
                        .split("<Order ID>").join(`Order ${contextVariables["Order ID"]}`)                              
                        .split("<Salesperson ID>").join(`Salesperson ${contextVariables["Salesperson ID"]}`);
                     console.log('sqJSON', sqJSON);
                     // Check if 'otherText' is just whitespace...
                     if (otherText.replace(/\s/g, '').length) {
                        console.log('posting "otherText" message:', otherText);
                        chat.renderMessage({
                           type: "text",
                           text: otherText
                        }, daVinciUser);
                     }
                     
                     chat.renderMessage({
                        type: "text",
                        text: "Here are some suggested further queries:"
                     }, daVinciUser);
                     chat.renderSuggestedActions(JSON.parse(sqJSON));
                  }

               });

            }
        },
        sendMessage: function(e) {
            console.log(e);
            
        },
        actionClick: function(e) {
            console.log(this);
            setTimeout(function() {
               chat.renderUserTypingIndicator(daVinciUser);
               $(".k-typing-indicator-bubble .k-author").text("Da Vinci is thinking");
            }, 400);                        
      }
   }).data("kendoChat");


   function technicalInfo() {
      setTimeout(function() {
         chat.clearUserTypingIndicator(daVinciUser);
         chat.renderAttachments({
            attachments: [{
               contentType: "technicalinfo",
               content: {
                  "title": techInfo["tile"].title,
                  "content": techInfo["tile"].content,
               }
            }],
            attachmentLayout: "list"
         }, daVinciUser);
         renderMsgActions();
         $(".k-message-list-content > div:last-child")[0].scrollIntoView();
         initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
      }, 3000);
      
   };
    
   function initWizard() {
      $("#wizard").kendoWizard({
         pager: true,
         done: function (e) {
            e.originalEvent.preventDefault();
            chat.renderMessage({
               type: "text",
               text: 'Great, the new XXX is now saved and accessible here.'
            }, daVinciUser);
         },
         steps: [
            {
                  title: "Step 1",
                  buttons: ["next"],
                  form: {
                     orientation: "vertical",
                     formData: {
                        One: "Some value",
                        2: "Another value",
                        Three: "And more value",
                     },
                     items: [
                        { field: "One", label: "Some field:", validation: { required: true } },
                        { field: "2", label: "Another field:", validation: { required: true } },
                        { field: "Three", label: "And another:", validation: { required: true }, hint: "Hint: enter alphanumeric characters only." }
                     ]
                  }
            },
            {
                  title: "Step 2",
                  buttons: ["previous", "done"],
                  form: {
                     orientation: "vertical",
                     items: [
                        { field: "ConfigName", label: "Config name", validation: { required: true } },
                        {
                              field: "ConfigOptions",
                              label: "Config options:",
                              validation: { required: true },
                              editor: "RadioGroup",
                              editorOptions: {
                                 items: ["One", "2", "Three"],
                                 layout: "horizontal",
                                 labelPosition: "before"
                              }
                        },
                        { field: "About", label: { text: "About:", optional: true } }
                     ]
                  }
            }]
      });
   }

   const salesData = [
            {
                "country": "United States",
                "year": "2012",
                "value": 30.1
            },
            {
                "country": "United States",
                "year": "2013",
                "value": 35.9
            },
            {
                "country": "United States",
                "year": "2014",
                "value": 43.1
            },
            {
                "country": "United States",
                "year": "2015",
                "value": 49.2
            },
            {
                "country": "United States",
                "year": "2016",
                "value": 59.0
            },
            {
                "country": "United States",
                "year": "2017",
                "value": 61.9
            },
            {
                "country": "United States",
                "year": "2018",
                "value": 65
            },
            {
                "country": "United States",
                "year": "2019",
                "value": 68.3
            },
            {
                "country": "United States",
                "year": "2020",
                "value": 69.2
            },
            {
                "country": "United States",
                "year": "2021",
                "value": 75.3
            },
            {
                "country": "United States",
                "year": "2022",
                "value": 74.2
            },
            
        ];
   const futureSales = [
      {
            "country": "United States",
            "year": "2022",
            "value": 74.2,
         //  "noteText": "Something"
      },
      {
            "country": "United States",
            "year": "2023",
            "value": 71.2
      },
      {
            "country": "United States",
            "year": "2024",
            "value": 74.2
      },
      {
            "country": "United States",
            "year": "2025",
            "value": 78.2,
         //  "noteText": "Something"
      }
   ];
            
   function createChart() {
      $("#chart").kendoChart({
         //  dataSource: {
         //      data: salesData
         //  },
         theme: "material",
         title: {
            text: "Sales performance"
         },
         legend: {
            visible: false
         },
         seriesDefaults: {
            type: "line",
            labels: {
               visible: true,
               format: "${0}m",
               background: "transparent"
            }
         },
         seriesClick: function(e) {
               if (e.series.name === "dvp") {
                  // Disable browser context menu
                  daVinciWindow.open();
                  setTimeout(function(){
                     $("#daVinciChat .k-message-box input").focus();
                  }, 220);
                  chat.renderAttachments({
                     attachments: [{
                        contentType: "davinciresponse",
                        content: {
                           "title": "Da Vinci trend prediction",
                           "content": "The data points on the dashed purple line are calculated by Da Vinci's trend prediction model. The model learns from your data, and estimates future values based on identified trends.",
                        }
                     }],
                     attachmentLayout: "list"
                  }, daVinciUser);
                  renderMsgActions();
                  $(".k-message-list-content > div:last-child")[0].scrollIntoView();
                  initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
               }
            },
         series: [{
            data: salesData,
            field: "value",
            categoryField: "year",
            name: "United States",
            highlight: {
               inactiveOpacity: 0.5
            }
         },
         {
            data: futureSales,
            dashType: "dash",
            field: "value",
            categoryField: "year",
            name: "dvp",
            color: "#7B1FA2",
            highlight: {
               inactiveOpacity: 0.5,
               visual: function(e) {
                  var group = new kendo.drawing.Group();
                  
                  var center = e.rect.center();
                  var circleGeometry = new kendo.geometry.Circle(center, 10);
                  var circle = new kendo.drawing.Circle(circleGeometry, {
                     fill: {
                        color: "#7B1FA2"
                     },
                     stroke: null,
                     cursor: "pointer"
                  });

                  var src = "img/davinci.png";
                  var image = new kendo.drawing.Image(src, e.rect);
                  image.options.cursor = "pointer";
                  group.options.cursor = "pointer";

                  group.append(circle, image);
                  return group;
               }
            }
         }],
         valueAxis: {
            labels: {
               format: "${0}m"
            },
            line: {
               visible: false
            }
         },
         categoryAxis: {
            majorGridLines: {
               visible: false
            }
         }
      });
   }
      
   $(".daVinciPopoverTrigger").each(function(idx, elem) {
      const title = $(elem).attr("data-bs-title") || "Da Vinci Generated Text";
      const popover = new bootstrap.Popover(elem, {
         html: true,
         title: title,
         trigger: "click focus",
         template: '<div class="popover" role="popover"><div class="popover-arrow"></div><h3 class="popover-header"><i class="material-icons">auto_awesome</i> Da Vinci Generated Text</h3><div class="popover-body"></div><div class="popover-footer sys-bg-very-light-gray"><a data-bs-toggle="tooltip" data-bs-title="Ping" class="showmodelcard" href="#"><i class="material-icons sys-fg-gray sys-txt-sm">edit_note</i></a><a class="conflevel" href="#"><i class="material-icons sys-fg-success sys-txt-sm">data_usage</i><span class="sys-fg-gray sys-txt-sm sys-mg-l-5">84%</span></a><a class="daVinciTellMore" href="#"><i class="sys-txt-sm material-icons sys-fg-primary">question_mark</i></a></div></div>'
      });
   });

   $(".daVinciDataPopoverTrigger").each(function(idx, elem) {
      const title = $(elem).attr("data-bs-title") || "DaVinci insight";
      const popover = new bootstrap.Popover(elem, {
         html: true,
         title: title,
         trigger: "click focus",
         template: '<div class="popover" role="popover"><div class="popover-arrow"></div><h3 class="popover-header"><i class="material-icons">auto_awesome</i> Da Vinci Insight</h3><div class="popover-body"></div><div class="popover-footer sys-bg-very-light-gray"><a data-bs-toggle="tooltip" data-bs-title="Ping" class="showmodelcard" href="#"><i class="material-icons sys-fg-gray sys-txt-sm">insights</i></a><a class="conflevel" href="#"><i class="material-icons sys-fg-warning sys-txt-sm">data_usage</i><span class="sys-fg-gray sys-txt-sm sys-mg-l-5">65%</span></a><a class="daVinciTellMoreData" href="#"><i class="sys-txt-sm material-icons sys-fg-primary">question_mark</i></a></div></div>'
      });
   });

   $(".daVinciAutoPopoverTrigger").each(function(idx, elem) {
      const title = $(elem).attr("data-bs-title") || "Da Vinci Automated Process";
      const popover = new bootstrap.Popover(elem, {
         html: true,
         title: title,
         trigger: "click focus",
         template: '<div class="popover" role="popover"><div class="popover-arrow"></div><h3 class="popover-header"><i class="material-icons">auto_awesome</i> Da Vinci Automated Process</h3><div class="popover-body"></div><div class="popover-footer sys-bg-very-light-gray"><a data-bs-toggle="tooltip" data-bs-title="Ping" class="showmodelcard" href="#"><i class="material-icons sys-fg-gray sys-txt-sm">smart_toy</i></a><a class="daVinciTellMoreAuto" href="#"><i class="sys-txt-sm material-icons sys-fg-primary">question_mark</i></a></div></div>'
      });
   });

   $(".davincifield").each(function(idx, elem) {
      const popover = new bootstrap.Popover(elem, {
         html: true,
         title: "Da Vinci Generated Data",
         trigger: "hover",
         content: "Field value generated by Da Vinci",
         customClass: "daVinciPopover",
         template: '<div class="popover" role="popover"><div class="popover-arrow"></div><h3 class="popover-header"><i class="material-icons">auto_awesome</i> Da Vinci Automated Process</h3><div class="popover-body">Field value generated by Da Vinci</div><div class="popover-footer sys-bg-very-light-gray"><a data-bs-toggle="tooltip" data-bs-title="Ping" class="showmodelcard" href="#"><i class="material-icons sys-fg-gray sys-txt-sm">edit_note</i></a><a class="conflevel" href="#"><i class="material-icons sys-fg-success sys-txt-sm">data_usage</i><span class="sys-fg-gray sys-txt-sm sys-mg-l-5">84%</span></a><a class="daVinciTellMore" href="#"><i class="sys-txt-sm material-icons sys-fg-primary">question_mark</i></a></div></div>'
      });
   });
   

   function initChatCardTooltips(elem) {
      $('[data-bs-toggle="tooltip"]', elem).each(function(idx, element) {
         const tooltip = new bootstrap.Tooltip(element);
      });            
   }

   $(document).on("click", ".daVinciTellMore", function(e) {
      const popoverId = $(this).closest(".daVinciPopover").attr("id");
      const trigger = $(`[aria-describedby="${popoverId}"]`);
      const contentId = trigger.attr("data-content-id");
      const popover = bootstrap.Popover.getInstance(trigger[0]);
      popover.hide();
      daVinciWindow.open();
      setTimeout(function(){
         $("#daVinciChat .k-message-box input").focus();
      }, 220);

      chat.renderAttachments({
         attachments: [{
            contentType: "davincisumresponse",
            content: {
               "title": responses[contentId].title,
               "content": responses[contentId].content,
            }
         }],
         attachmentLayout: "list"
      }, daVinciUser);
      renderMsgActions();
      $(".k-message-list-content > div:last-child")[0].scrollIntoView();
      initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
   });

   $(document).on("click", ".daVinciTellMoreData", function(e) {
      const popoverId = $(this).closest(".daVinciPopover").attr("id");
      const trigger = $(`[aria-describedby="${popoverId}"]`);
      const contentId = trigger.attr("data-content-id");
      const popover = bootstrap.Popover.getInstance(trigger[0]);
      popover.hide();
      daVinciWindow.open();
      setTimeout(function(){
         $("#daVinciChat .k-message-box input").focus();
      }, 220);

      chat.renderAttachments({
         attachments: [{
            contentType: "davincitileresponse",
            content: {
               "title": responses[contentId].title,
               "content": responses[contentId].content,
            }
         }],
         attachmentLayout: "list"
      }, daVinciUser);
      renderMsgActions();
      $(".k-message-list-content > div:last-child")[0].scrollIntoView();
      initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
   });

   $(document).on("click", ".daVinciTellMoreAuto", function(e) {
      const popoverId = $(this).closest(".daVinciPopover").attr("id");
      const trigger = $(`[aria-describedby="${popoverId}"]`);
      const contentId = trigger.attr("data-content-id");
      const popover = bootstrap.Popover.getInstance(trigger[0]);
      popover.hide();
      daVinciWindow.open();
      setTimeout(function(){
         $("#daVinciChat .k-message-box input").focus();
      }, 220);

      chat.renderAttachments({
         attachments: [{
            contentType: "davinciautoresponse",
            content: {
               "title": responses[contentId].title,
               "content": responses[contentId].content,
            }
         }],
         attachmentLayout: "list"
      }, daVinciUser);

      $(".k-message-list-content > div:last-child")[0].scrollIntoView();
      initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
   });

   $(document).on("click", ".conflevel", function(e) {      
      const popoverId = $(this).closest(".daVinciPopover").attr("id");
      const trigger = $(`[aria-describedby="${popoverId}"]`);
      const contentId = trigger.attr("data-content-id");
      const popover = bootstrap.Popover.getInstance(trigger[0]);
      popover?.hide();
      daVinciWindow.open();      
      chat.renderAttachments({
         attachments: [{
            contentType: "confidence",
            content: {
               
            }
         }],
         attachmentLayout: "list"
      }, daVinciUser);
      renderMsgActions();
      $(".k-message-list-content > div:last-child")[0].scrollIntoView();
      // initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
   });

   $(document).on("click", ".showmodelcard", function(e) {      
      const popoverId = $(this).closest(".daVinciPopover").attr("id");
      const trigger = $(`[aria-describedby="${popoverId}"]`);
      const contentId = trigger.attr("data-content-id");
      const popover = bootstrap.Popover.getInstance(trigger[0]);
      popover?.hide();
      daVinciWindow.open();      
      chat.renderAttachments({
         attachments: [{
            contentType: "models",
            content: {
               
            }
         }],
         attachmentLayout: "list"
      }, daVinciUser);
      renderMsgActions();
      $(".k-message-list-content > div:last-child")[0].scrollIntoView();
      // initChatCardTooltips($(".k-message-list-content > div:last-child")[0]);
   });

   $(document).on("click", ".clickable", function() {
      alert("Take the user to the relevant program in Avanti");
   });

   function onSuccess(e) {
      console.log('upload success!');  
      $(".file-upload-details").show(300);                  
   }
   
   function addPreview(file, wrapper) {
      var raw = file.rawFile;
      var reader  = new FileReader();
      if (raw) {
      reader.onloadend = function () {
         var preview = $("<img class='image-preview'>").attr("src", this.result);
         wrapper.find(".k-file[data-uid='" + file.uid + "'] .k-file-extension-wrapper")
         .replaceWith(preview);
      };

      reader.readAsDataURL(raw);
      }
   }

   $("#files").kendoUpload({
      async: {
         saveUrl: "http://127.0.0.1:5500/UXTools/api/UXFileProviderWeb/UploadDocument",
         removeUrl: "remove",
         autoUpload: true,
      },
      validation: {
         allowedExtensions: [".jpg", ".jpeg", ".png", ".bmp", ".gif", ".pdf", ".doc", ".docx", ".xls"],
      },
      // template: kendo.template($('#fileTemplate').html()),
      success: onSuccess,
      showFileList: true,
      select: function(e) {
         var fileInfo = e.files[0];
         var wrapper = this.wrapper;

         setTimeout(function(){
               addPreview(fileInfo, wrapper);
         });
      }
   });

   $(".k-dropzone")
      .find("em")
      .remove();
   $(".k-dropzone")
      .find(".k-dropzone-hint")
      .remove();
   $(".k-dropzone .k-upload-button")
      .find("span")
      .text("Drop file here or click to upload");
   $(".k-dropzone .k-upload-button").prepend(
      "<h3 class='sys-mg-t-10 sys-mg-r-10'><i class='material-icons text-muted'>cloud_upload</i></h3>"
   );
   
   $(document).ready(createChart);

   const confGridData = [
      {
         name: "Bicycle Spokes",
         id: "00HG54",
         date: "09/10/2023",
         daysLate: 7,
         confidence: 0.55,
      },
      {
         name: "Racing Seat",
         id: "00HG52",
         date: "08/10/2023",
         daysLate: 5,
         confidence: 0.23,
      },
      {
         name: "ABS Brakes",
         id: "00TTG54",
         date: "07/10/2023",
         daysLate: 3,
         confidence: 1,
      },
      {
         name: "Racing Handlebar",
         id: "00JG89",
         date: "06/10/2023",
         daysLate: 8,
         confidence: 0.78,
      },
   ];

   $("#confGrid").kendoGrid({
      dataSource: {
         data: confGridData,
         pageSize: 20,
         schema: {
            model: {
                  id: "id"
            }
         }
      },
      dataBound: onDataBound,
      columns: [
         {
            field: "id",
            title: "StockCode",
         },
         {
            field: "name",
            title: "Name",
         },
         {
            field: "date",
            title: "Date due",
         },
         {
            field: "daysLate",
            title: "Days late",
            template: "<span><b>Expected #= daysLate# days late</b></span><span id='chart_#= id#' class='sparkline-chart pull-right'></span>",
            width: 170,
            headerTemplate: 'Expected Days Late <i class="material-icons pull-right align-right davinciicon-light sys-txt-sm">auto_awesome</i>'
         },
      ]
   });

   function onDataBound(e) {
      var grid = this;
      grid.table.find("tr").each(function () {
         var dataItem = grid.dataItem(this);      
         $(this).find(".sparkline-chart").kendoSparkline({
            legend: {
               visible: false
            },
            series: [{
               data: [{
                  value: dataItem.confidence * 100,
                  color: dataItem.confidence > 0.74 
                     ? "green"
                     : dataItem.confidence > 0.49 && dataItem.confidence < 0.75
                     ? "orange"
                     : "red",               
               },
               {
                  value: (1 - dataItem.confidence) * 100,
                  color: "#ccc",               
               }],
               tooltip: {
                  visible: true,
                  background: "#444",
                  color: "#fff",
                  border: {
                     width: 0
                  },
                  template: function() {
                     var adjustConf = Math.round(dataItem.confidence * 100);
                     return adjustConf + "% chance";
                  }
               }
            }],               
            type: "donut",
            chartArea: {
               margin: 0,
               width: 30,
               background: "transparent"
            },
            seriesDefaults: {
               size: 4,
               tooltip: {
                  visible: false
               }
            },         
         });
         kendo.bind($(this), dataItem);
      });
   }


   function tokenize(input) {
    var current = 0;
    var tokens = [];

    while (current < input.length) {
      var char = input[current];

      if (char === '\\') {
        current++;
        continue;
      }

      if (char === '{') {
        tokens.push({
          type: 'brace',
          value: '{'
        });

        current++;
        continue;
      }

      if (char === '}') {
        tokens.push({
          type: 'brace',
          value: '}'
        });

        current++;
        continue;
      }

      if (char === '[') {
        tokens.push({
          type: 'paren',
          value: '['
        });

        current++;
        continue;
      }

      if (char === ']') {
        tokens.push({
          type: 'paren',
          value: ']'
        });

        current++;
        continue;
      }

      if (char === ':') {
        tokens.push({
          type: 'separator',
          value: ':'
        });

        current++;
        continue;
      }

      if (char === ',') {
        tokens.push({
          type: 'delimiter',
          value: ','
        });

        current++;
        continue;
      }

      if (char === '"') {
        var value = '';
        var danglingQuote = false;

        char = input[++current];

        while (char !== '"') {
          if (current === input.length) {
            danglingQuote = true;
            break;
          }

          if (char === '\\') {
            current++;
            if (current === input.length) {
              danglingQuote = true;
              break;
            }
            value += char + input[current];
            char = input[++current];
          } else {
            value += char;
            char = input[++current];
          }
        }

        char = input[++current];

        if (!danglingQuote) {
          tokens.push({
            type: 'string',
            value: value
          });
        }
        continue;
      }

      var WHITESPACE = /\s/;
      if (WHITESPACE.test(char)) {
        current++;
        continue;
      }

      var NUMBERS = /[0-9]/;
      if (NUMBERS.test(char) || char === '-' || char === '.') {
        var _value = '';

        if (char === '-') {
          _value += char;
          char = input[++current];
        }

        while (NUMBERS.test(char) || char === '.') {
          _value += char;
          char = input[++current];
        }

        tokens.push({
          type: 'number',
          value: _value
        });
        continue;
      }

      var LETTERS = /[a-z]/i;
      if (LETTERS.test(char)) {
        var _value2 = '';

        while (LETTERS.test(char)) {
          if (current === input.length) {
            break;
          }
          _value2 += char;
          char = input[++current];
        }

        if (_value2 == 'true' || _value2 == 'false') {
          tokens.push({
            type: 'name',
            value: _value2
          });
        } else {
          throw new Error('Invalid token:', _value2 + ' is not a valid token!');
        }
        continue;
      }

      current++;
    }

    return tokens;
  }
  
  function strip(tokens) {
    if (tokens.length === 0) {
      return tokens;
    }

    var lastToken = tokens[tokens.length - 1];

    switch (lastToken.type) {
      case 'separator':
        tokens = tokens.slice(0, tokens.length - 1);
        return strip(tokens);
        break;
      case 'number':
        var lastCharacterOfLastToken = lastToken.value[lastToken.value.length - 1];
        if (lastCharacterOfLastToken === '.' || lastCharacterOfLastToken === '-') {
          tokens = tokens.slice(0, tokens.length - 1);
          return strip(tokens);
        }
      case 'string':
        var tokenBeforeTheLastToken = tokens[tokens.length - 2];
        if (tokenBeforeTheLastToken.type === 'delimiter') {
          tokens = tokens.slice(0, tokens.length - 1);
          return strip(tokens);
        } else if (tokenBeforeTheLastToken.type === 'brace' && tokenBeforeTheLastToken.value === '{') {
          tokens = tokens.slice(0, tokens.length - 1);
          return strip(tokens);
        }
        break;
      case 'delimiter':
        tokens = tokens.slice(0, tokens.length - 1);
        return strip(tokens);
        break;
    }

    return tokens;
  }
  
  function unstrip(tokens) {
    var tail = [];

    tokens.map(function (token) {
      if (token.type === 'brace') {
        if (token.value === '{') {
          tail.push('}');
        } else {
          tail.splice(tail.lastIndexOf('}'), 1);
        }
      }
      if (token.type === 'paren') {
        if (token.value === '[') {
          tail.push(']');
        } else {
          tail.splice(tail.lastIndexOf(']'), 1);
        }
      }
    });

    if (tail.length > 0) {
      tail.reverse().map(function (item) {
        if (item === '}') {
          tokens.push({
            type: 'brace',
            value: '}'
          });
        } else if (item === ']') {
          tokens.push({
            type: 'paren',
            value: ']'
          });
        }
      });
    }

    return tokens;
  }
  
  function generate(tokens) {
    var output = '';

    tokens.map(function (token) {
      switch (token.type) {
        case 'string':
          output += '"' + token.value + '"';
          break;
        default:
          output += token.value;
          break;
      }
    });

    return output;
  }
  
  function partialParse(input) {
    return JSON.parse(generate(unstrip(strip(tokenize(input)))));
  };


</script>
  
  </body>
</html>